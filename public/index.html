<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Divirgent Test V2.1 – OCEAN (LT)</title>

  <style>
    :root{
      --bg:#0f1720; --fg:#eaf0f6; --muted:#9fb3c8; --panel:#13212b; --line:#213241;
      --accent:#4dc0b5; --accent2:#1b2a36;
    }
    *{box-sizing:border-box}
    body { background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.45; margin:0; }
    header, main, footer { max-width:980px; margin:0 auto; padding:16px; }
    h1,h2,h3{margin:.6em 0}
    p{margin:.4em 0 .8em}
    .actions { display:flex; flex-wrap:wrap; gap:12px; margin:12px 0 20px; }
    .actions.center { justify-content:center; }
    button { background:var(--accent); color:var(--bg); border:0; padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer; }
    button.secondary { background:var(--accent2); color:var(--fg); border:1px solid #274254; }
    .hidden { display:none !important; }

    #globalError { background:#3b1f29; color:#ffdce0; border:1px solid #6b2737; padding:10px 12px; border-radius:8px; margin:10px 0; }

    .card { background:#13212b; border:1px solid #213241; border-radius:10px; padding:12px; margin-top:10px; }
    .item { padding:14px 12px; border:1px solid #213241; border-radius:10px; margin:10px 0; background:#0f1a23; }
    .item h4 { margin:0 0 10px; font-size:16px; }
    .domain-tag { color:#9fb3c8; font-weight:500; font-size:12px; margin-left:6px; }
    .scale { display:grid; grid-template-columns: repeat(5, minmax(160px,1fr)); gap:8px; }
    label { display:flex; align-items:center; gap:8px; background:#0f1a23; padding:8px 10px; border-radius:8px; border:1px solid #203141; color:var(--fg); }

    table { width:100%; border-collapse: collapse; margin-top:10px; }
    th, td { border:1px solid #213241; padding:8px; text-align:left; }
    th { background:#152431; }

    .list { display:grid; gap:10px; margin:8px 0 6px; padding-left:0; list-style:none; }
    .pill { display:flex; gap:8px; padding:10px 12px; background:#0f1a23; border:1px solid #203141; border-radius:10px; }
    .pill strong { white-space:nowrap; }
    .pill .pct { color:#9adbd4; font-weight:700; }

    .grid-cards { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); }
    .tcard { background:#0f1a23; border:1px solid #203141; border-radius:10px; padding:12px; }
    .tcard h4 { margin:0 0 6px; font-size:16px; }
    .tcard p  { margin:0; color:#cfe1ee; }

    footer { color:#9fb3c8; font-size:13px; text-align:center; padding:20px 16px 28px; }

    /* Spausdinimui – slepiame valdiklius/klausimus, paliekame rezultatus */
    @media print {
      body { background:#fff; color:#000; }
      header, .no-print, .actions, #items { display:none !important; }
      #results, #results * { color:#000 !important; background:#fff !important; border-color:#000 !important; }
      a { color:#000; text-decoration:none; }
      .card { page-break-inside: avoid; }
    }
  </style>
</head>

<body>
<header>
  <h1>Divirgent Test V2.1 – OCEAN (LT)</h1>
  <p class="no-print">~8–10 min · 60 teiginių · be prisijungimo · skaičiuojama naršyklėje</p>

  <div id="globalError" class="hidden"></div>

  <div class="actions no-print">
    <button id="btnStart">Pereiti prie teiginių</button>
    <button id="btnReset" class="secondary">Išvalyti</button>
  </div>
</header>

<main>
  <!-- TEIGINIAI -->
  <section id="items" class="card">
    <h2>Teiginiai</h2>
    <p>Likertas: 1 – Visiškai nesutinku · 5 – Visiškai sutinku. Invertuoti teiginiai skaičiuojami priešingai.</p>

    <div id="itemsContainer" class="no-print"></div>

    <div class="actions center no-print">
      <button id="btnSubmit">Gauti rezultatą</button>
    </div>
  </section>

  <!-- REZULTATAI -->
  <section id="results" class="card">
    <h2>Rezultatai</h2>
    <p id="summary">Užpildykite visus teiginius ir paspauskite „Gauti rezultatą“.</p>

    <!-- Lentelė -->
    <table id="tblScores" class="hidden">
      <thead>
        <tr>
          <th>Domenas</th>
          <th>Vidurkis (1–5)</th>
          <th>Normalizuota (–1…+1)</th>
          <th>%</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Nauja: TOP‑3 pagal OCEAN (stiprybės) -->
    <h3 id="oStrengthHdr" class="hidden">TOP‑3 stiprybės (OCEAN)</h3>
    <ul id="oStrengthList" class="list hidden"></ul>

    <!-- Nauja: TOP‑3 augimo sritys su rekomendacijomis -->
    <h3 id="oGrowthHdr" class="hidden">TOP‑3 augimo sritys (su rekomendacijomis)</h3>
    <ul id="oGrowthList" class="list hidden"></ul>

    <!-- TOP‑3 tipai kaip anksčiau -->
    <h3 id="typesHdr" class="hidden">Tipų artimumas (TOP‑3)</h3>
    <div id="typeCards" class="grid-cards hidden"></div>

    <div class="actions no-print hidden" id="printActions">
      <button id="btnPrint">Spausdinti PDF</button>
      <span style="color:#9fb3c8;font-size:12px">Naudokite naršyklės dialogą „Išsaugoti kaip PDF“.</span>
    </div>
  </section>
</main>

<footer class="no-print">
  © 2025 Divirgent Test · Vieno failo versija (index.html)
</footer>

<!-- 1) Inline JSON – 60 unikalių teiginių + centroidai tipams -->
<script type="application/json" id="itemsData">
{
  "name": "Divirgent Test V2.1 (LT)",
  "likert": ["Visiškai nesutinku","Nesutinku","Nei taip, nei ne","Sutinku","Visiškai sutinku"],
  "items_full": [
    {"id":"E1","domain":"Ekstraversija","reverse":false,"text":"Mėgstu bendrauti su nepažįstamais žmonėmis."},
    {"id":"E2","domain":"Ekstraversija","reverse":true,"text":"Mieliau renkuosi laiką vienumoje."},
    {"id":"E3","domain":"Ekstraversija","reverse":false,"text":"Greitai pradedu pokalbį naujoje grupėje."},
    {"id":"E4","domain":"Ekstraversija","reverse":true,"text":"Dideli susibūrimai mane vargina."},
    {"id":"E5","domain":"Ekstraversija","reverse":false,"text":"Jaučiu energijos pakilimą būdamas tarp žmonių."},
    {"id":"E6","domain":"Ekstraversija","reverse":true,"text":"Vengiu būti dėmesio centre."},
    {"id":"E7","domain":"Ekstraversija","reverse":false,"text":"Greitai perimu iniciatyvą grupėje."},
    {"id":"E8","domain":"Ekstraversija","reverse":true,"text":"Nesijaučiu patogiai, kai reikia kalbėti prieš auditoriją."},
    {"id":"E9","domain":"Ekstraversija","reverse":false,"text":"Lengvai mezgu naujas pažintis."},
    {"id":"E10","domain":"Ekstraversija","reverse":true,"text":"Retai imuosi kalbėti pirmas/pirma."},
    {"id":"E11","domain":"Ekstraversija","reverse":false,"text":"Entuziastingai dalyvauju renginiuose."},
    {"id":"E12","domain":"Ekstraversija","reverse":true,"text":"Po socialinių veiklų ilgai atgaunu jėgas."},

    {"id":"A1","domain":"Malonumas","reverse":false,"text":"Empatiškai reaguoju į kitų jausmus."},
    {"id":"A2","domain":"Malonumas","reverse":true,"text":"Dažnai ginčijuosi dėl smulkmenų."},
    {"id":"A3","domain":"Malonumas","reverse":false,"text":"Lengvai atleidžiu klaidas."},
    {"id":"A4","domain":"Malonumas","reverse":true,"text":"Esu šaltas ir abejingas kitų poreikiams."},
    {"id":"A5","domain":"Malonumas","reverse":false,"text":"Gerbiu skirtingus požiūrius."},
    {"id":"A6","domain":"Malonumas","reverse":true,"text":"Įtariai vertinu kitų ketinimus."},
    {"id":"A7","domain":"Malonumas","reverse":false,"text":"Pastebiu, kai žmogui reikia palaikymo."},
    {"id":"A8","domain":"Malonumas","reverse":true,"text":"Dažnai kalbu kandžiai ar sarkastiškai."},
    {"id":"A9","domain":"Malonumas","reverse":false,"text":"Sąžiningai dalinuosi nuopelnais su komanda."},
    {"id":"A10","domain":"Malonumas","reverse":true,"text":"Greitai teisiu žmones griežčiau nei reikėtų."},
    {"id":"A11","domain":"Malonumas","reverse":false,"text":"Mėgstu ieškoti abiem pusėms tinkamo kompromiso."},
    {"id":"A12","domain":"Malonumas","reverse":true,"text":"Man sunku parodyti šilumą ir rūpestį."},

    {"id":"C1","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Laikausi tvarkaraščių ir terminų."},
    {"id":"C2","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai atidėlioju pradėti užduotis."},
    {"id":"C3","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Kruopščiai planuoju darbus."},
    {"id":"C4","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Lengvai numetu pradėtą darbą dėl nuobodulio."},
    {"id":"C5","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Atlieku darbus iki galo."},
    {"id":"C6","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai pritrūksta dėmesio detalėms."},
    {"id":"C7","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Mano darbo vieta paprastai tvarkinga."},
    {"id":"C8","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Pradedu darbus jų neapgalvojęs/usi."},
    {"id":"C9","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Nuosekliai siekiu užsibrėžtų tikslų."},
    {"id":"C10","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Greitai prarandu motyvaciją ilguose projektuose."},
    {"id":"C11","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Jaučiu asmeninę atsakomybę už įsipareigojimus."},
    {"id":"C12","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Esu išsiblaškęs ir neorganizuotas."},

    {"id":"N1","domain":"Neurotiškumas","reverse":false,"text":"Lengvai nerimauju dėl ateities."},
    {"id":"N2","domain":"Neurotiškumas","reverse":true,"text":"Išlaikau ramybę spaudžiant terminams."},
    {"id":"N3","domain":"Neurotiškumas","reverse":false,"text":"Mano nuotaika dažnai svyruoja."},
    {"id":"N4","domain":"Neurotiškumas","reverse":true,"text":"Gerai valdau stresą sudėtingose situacijose."},
    {"id":"N5","domain":"Neurotiškumas","reverse":false,"text":"Greitai susierzinu dėl smulkmenų."},
    {"id":"N6","domain":"Neurotiškumas","reverse":true,"text":"Esu emociškai stabilus ir atsparus."},
    {"id":"N7","domain":"Neurotiškumas","reverse":false,"text":"Kartais jaučiu nerimą be aiškios priežasties."},
    {"id":"N8","domain":"Neurotiškumas","reverse":true,"text":"Net kritikuojamas/-a išlaikau pusiausvyrą."},
    {"id":"N9","domain":"Neurotiškumas","reverse":false,"text":"Lengvai pasiduodu liūdnoms mintims."},
    {"id":"N10","domain":"Neurotiškumas","reverse":true,"text":"Greitai atgaunu vidinę pusiausvyrą po nesėkmės."},
    {"id":"N11","domain":"Neurotiškumas","reverse":false,"text":"Įtampa mane užklumpa net menkniekiuose."},
    {"id":"N12","domain":"Neurotiškumas","reverse":true,"text":"Netikėtose situacijose išlieku ramus/-i."},

    {"id":"O1","domain":"Atvirumas patirčiai","reverse":false,"text":"Mėgstu tyrinėti naujas idėjas."},
    {"id":"O2","domain":"Atvirumas patirčiai","reverse":true,"text":"Rinkiuosi tik įprastas, patikrintas veiklas."},
    {"id":"O3","domain":"Atvirumas patirčiai","reverse":false,"text":"Domiuosi menu, muzika ar literatūra."},
    {"id":"O4","domain":"Atvirumas patirčiai","reverse":true,"text":"Vengiu abstrakčių ar teorinių temų."},
    {"id":"O5","domain":"Atvirumas patirčiai","reverse":false,"text":"Sugalvoju naujų būdų pagerinti esamus dalykus."},
    {"id":"O6","domain":"Atvirumas patirčiai","reverse":true,"text":"Mieliau lieku prie tradicinių sprendimų."},
    {"id":"O7","domain":"Atvirumas patirčiai","reverse":false,"text":"Smalsiai gilin(u)osi į sudėtingas temas."},
    {"id":"O8","domain":"Atvirumas patirčiai","reverse":true,"text":"Vengiu naujų metodų ar technologijų."},
    {"id":"O9","domain":"Atvirumas patirčiai","reverse":false,"text":"Idėjas dažnai vizualizuoju vaizdais ar metaforomis."},
    {"id":"O10","domain":"Atvirumas patirčiai","reverse":true,"text":"Retai užduodu klausimą „o jeigu…?“."},
    {"id":"O11","domain":"Atvirumas patirčiai","reverse":false,"text":"Mėgstu kurti – nuo sprendimų iki dizaino."},
    {"id":"O12","domain":"Atvirumas patirčiai","reverse":true,"text":"Nelaikau savęs kūrybišku žmogumi."}
  ],
  "type_centroids": {
    "Dirigentė":   {"E":0.8,"A":0.2,"C":0.8,"ES":0.6,"O":0.2},
    "Analitikas":  {"E":-0.6,"A":0.0,"C":0.4,"ES":0.6,"O":0.8},
    "Diplomatė":   {"E":0.2,"A":0.8,"C":0.2,"ES":0.6,"O":0.2},
    "Inovatorė":   {"E":0.6,"A":-0.2,"C":-0.1,"ES":0.3,"O":0.9},
    "Stabilizuotoja":{"E":-0.4,"A":0.6,"C":0.8,"ES":0.8,"O":-0.4},
    "Mentorius":   {"E":0.2,"A":0.8,"C":0.7,"ES":0.7,"O":0.3},
    "Variklis":    {"E":0.9,"A":-0.1,"C":0.6,"ES":0.3,"O":0.7},
    "Architektė":  {"E":-0.5,"A":-0.3,"C":0.7,"ES":0.7,"O":0.9}
  }
}
</script>

<!-- 2) Visa logika inline – be fetch, be bibliotekų -->
<script>
(() => {
  'use strict';

  // ---- DOM
  const el = {
    btnStart: document.getElementById('btnStart'),
    btnSubmit: document.getElementById('btnSubmit'),
    btnReset: document.getElementById('btnReset'),

    itemsWrap: document.getElementById('itemsContainer'),
    itemsSection: document.getElementById('items'),

    tbl: document.getElementById('tblScores'),
    tblBody: document.querySelector('#tblScores tbody'),

    summary: document.getElementById('summary'),
    globalErr: document.getElementById('globalError'),
    results: document.getElementById('results'),
    printActions: document.getElementById('printActions'),

    oStrengthHdr: document.getElementById('oStrengthHdr'),
    oStrengthList: document.getElementById('oStrengthList'),
    oGrowthHdr: document.getElementById('oGrowthHdr'),
    oGrowthList: document.getElementById('oGrowthList'),

    typesHdr: document.getElementById('typesHdr'),
    typeCards: document.getElementById('typeCards')
  };

  // ---- Būsena
  let META = null;
  let ITEMS = [];

  // ---- Žodynai
  const DOMAIN_LABELS = {
    E: 'Ekstraversija', A: 'Malonumas', C: 'Sąžiningumas/Atidumas', ES: 'Emocinis stabilumas', O: 'Atvirumas patirčiai'
  };
  const DOMAIN_DESCR = {
    E: 'Energija, iniciatyva ir socialinis aktyvumas.',
    A: 'Empatija, pagarba ir bendradarbiavimas.',
    C: 'Tvarka, atsakomybė ir nuoseklus siekis.',
    ES:'Ramybė, streso valdymas ir emocinė pusiausvyra.',
    O: 'Smalsumas, naujos idėjos ir kūrybiškumas.'
  };
  const DOMAIN_TIPS = {
    E: ['Planuok 1–2 socialinius „mini‑išėjimus“ per savaitę.', 'Kartą per mėnesį – viešas pasisakymas/ataskaita komandoje.', 'Treniruok iniciatyvą: pirmas(-a) užduok 1 klausimą susitikime.'],
    A: ['Kasdien sąmoningai padėkok 1 žmogui už konkretų veiksmą.', 'Konfliktuose naudok „Aš‑žinutes“ vietoj „Tu‑kaltini“.', 'Skirk 15 min. empatiniam klausymui be pertraukimų.'],
    C: ['Darbų valdymas: „Top‑3“ prioritetai kiekvienos dienos pradžioje.', 'Laiko dėžutės (time‑boxing): 25–50 min. blokai be trikdžių.', '„Uždarymo ritualas“: 10 min. tvarka darbo pabaigoje.'],
    ES:['2–3 kartus per dieną 2 min. kvėpavimo ciklas (4‑4‑6).', '„Streso žurnalas“: trigeris → reakcija → alternatyvi interpretacija.', 'Planas „B“ kritinėms situacijoms – 3 konkretūs žingsniai.'],
    O: ['Kas savaitę – 1 naujas šaltinis (straipsnis, podcast).', 'Idėjų „3x“: kiekvienai problemai – 3 alternatyvos.', 'Įtrauk „mini prototipą“ prieš ilgą įgyvendinimą.']
  };
  const TYPE_DESCR = {
    'Dirigentė':'Kryptis, standartai, sprendimų tempas; rizika – perkontrolė.',
    'Analitikas':'Duomenys, logika, sisteminis mąstymas; rizika – peranalizavimas.',
    'Diplomatė':'Santykiai, kompromisai, empatija; rizika – konfliktų vengimas.',
    'Inovatorė':'Naujovės, eksperimentai, galimybių matymas; rizika – neužbaigtumas.',
    'Stabilizuotoja':'Nuoseklumas, procesai, kokybė; rizika – pasipriešinimas pokyčiams.',
    'Mentorius':'Ugdymas, grįžtamasis ryšys; rizika – per didelė globa.',
    'Variklis':'Aktyvacija, energija, rezultatas; rizika – per didelis spaudimas.',
    'Architektė':'Struktūra, dizainas, ilgalaikė logika; rizika – teorinis šaltumas.'
  };

  // ---- Pagalbinės
  const scrollTo = (node) => node?.scrollIntoView({ behavior:'smooth', block:'start' });
  const normMinus1to1 = (mean15) => ((mean15 - 3) / 2);
  const pct0to100     = (mean15) => Math.round(((mean15 - 1) / 4) * 100);

  const showError = (msg) => { if (!el.globalErr) { console.error(msg); return; } el.globalErr.textContent = msg; el.globalErr.classList.remove('hidden'); };
  const clearError = () => { if (!el.globalErr) return; el.globalErr.textContent=''; el.globalErr.classList.add('hidden'); };

  const isReversed = (item) => item?.reverse === true;

  const byDomain = (arr) => {
    const map = new Map();
    for (const r of arr) { if (!map.has(r.domain)) map.set(r.domain, []); map.get(r.domain).push(r.value); }
    const out = {};
    for (const [k, vals] of map.entries()) out[k] = { mean: vals.reduce((a,b)=>a+b,0)/vals.length, n: vals.length };
    return out;
  };

  // N -> ES (emocinis stabilumas) vektoriui/rikiavimui
  const toVec = (scores) => {
    const E = normMinus1to1(scores['Ekstraversija'].mean);
    const A = normMinus1to1(scores['Malonumas'].mean);
    const C = normMinus1to1(scores['Sąžiningumas/Atidumas'].mean);
    const N = normMinus1to1(scores['Neurotiškumas'].mean);
    const ES = -N; // kuo mažiau N, tuo daugiau ES
    const O = normMinus1to1(scores['Atvirumas patirčiai'].mean);
    return {E,A,C,ES,O};
  };

  const euclid = (p, q) => {
    const keys = ['E','A','C','ES','O'];
    return Math.sqrt(keys.reduce((s,k)=> s + Math.pow((p[k]??0)-(q[k]??0),2), 0));
  };
  const top3Types = (vec, centroids) => {
    if (!centroids) return [];
    const arr = Object.entries(centroids).map(([name,c])=>{
      const d = euclid(vec,c);
      const sim = 1/(1+d);
      return {name, dist:d, sim};
    }).sort((a,b)=>a.dist-b.dist).slice(0,3);
    return arr;
  };

  // ---- Forma
  const renderForm = () => {
    const likert = META?.likert ?? ["Visiškai nesutinku","Nesutinku","Nei taip, nei ne","Sutinku","Visiškai sutinku"];
    const frag = document.createDocumentFragment();
    ITEMS.forEach((it, idx) => {
      const row = document.createElement('div'); row.className = 'item';
      const inv = isReversed(it);
      const tag = document.createElement('h4');
      tag.innerHTML = `${idx+1}. ${it.text} <span class="domain-tag">(${it.domain}${inv ? ', invertuotas' : ''})</span>`;
      row.appendChild(tag);

      const scale = document.createElement('div'); scale.className = 'scale';
      for (let v=1; v<=5; v++){
        const id = `${it.id}_${v}`;
        const label = document.createElement('label');
        const input = document.createElement('input');
        input.type = 'radio'; input.name = it.id; input.id = id; input.value = String(v); input.required = true;
        const txt = document.createElement('span'); txt.textContent = `${v} – ${likert[v-1]}`;
        label.htmlFor = id; label.appendChild(input); label.appendChild(txt);
        scale.appendChild(label);
      }
      row.appendChild(scale);
      frag.appendChild(row);
    });
    el.itemsWrap.innerHTML = '';
    el.itemsWrap.appendChild(frag);
  };

  const readResponses = () => {
    const out = [];
    for (const it of ITEMS){
      const sel = document.querySelector(`input[name="${it.id}"]:checked`);
      if (!sel) return { ok:false, missing: it.id };
      const raw = Number(sel.value);
      const val = isReversed(it) ? (6 - raw) : raw;
      out.push({ id:it.id, domain:it.domain, raw, value:val });
    }
    return { ok:true, rows: out };
  };

  const renderScores = (scores) => {
    // 1) Lentelė
    el.tblBody.innerHTML = '';
    const order = ['Ekstraversija','Malonumas','Sąžiningumas/Atidumas','Neurotiškumas','Atvirumas patirčiai'];
    for (const key of order){
      const s = scores[key];
      const norm = normMinus1to1(s.mean);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${key}</td>
        <td>${s.mean.toFixed(2)}</td>
        <td>${norm >= 0 ? '+' : ''}${norm.toFixed(2)}</td>
        <td>${pct0to100(s.mean)}%</td>
      `;
      el.tblBody.appendChild(tr);
    }
    el.tbl.classList.remove('hidden');
  };

  const renderOCEANTop3 = (scores) => {
    // Konvertuojame į E,A,C,ES,O (ES = 6-N vidurkis -> vėliau paverčiame į %)
    const means = {
      E: scores['Ekstraversija'].mean,
      A: scores['Malonumas'].mean,
      C: scores['Sąžiningumas/Atidumas'].mean,
      ES: 6 - scores['Neurotiškumas'].mean,
      O: scores['Atvirumas patirčiai'].mean
    };
    const pairs = Object.entries(means).map(([k,m]) => ({k, label:DOMAIN_LABELS[k], pct: pct0to100(m)}));

    // Stiprybės (nuo didžiausio %)
    const strengths = [...pairs].sort((a,b)=> b.pct - a.pct).slice(0,3);
    el.oStrengthList.innerHTML = '';
    strengths.forEach(s=>{
      const li = document.createElement('li'); li.className='pill';
      li.innerHTML = `<strong>${s.label}</strong><span class="pct">${s.pct}%</span><span>— ${DOMAIN_DESCR[s.k]}</span>`;
      el.oStrengthList.appendChild(li);
    });
    el.oStrengthHdr.classList.remove('hidden');
    el.oStrengthList.classList.remove('hidden');

    // Augimo sritys (nuo mažiausio %)
    const growth = [...pairs].sort((a,b)=> a.pct - b.pct).slice(0,3);
    el.oGrowthList.innerHTML = '';
    growth.forEach(g=>{
      const tips = DOMAIN_TIPS[g.k] || [];
      const li = document.createElement('li'); li.className='pill';
      const tipsHtml = tips.length ? `<ul style="margin:6px 0 0 14px;padding:0;">${tips.map(t=>`<li>${t}</li>`).join('')}</ul>` : '';
      li.innerHTML = `<div><strong>${g.label}</strong> <span class="pct">${g.pct}%</span><div style="margin-top:4px;color:#cfe1ee;">Rekomendacijos:${tipsHtml}</div></div>`;
      el.oGrowthList.appendChild(li);
    });
    el.oGrowthHdr.classList.remove('hidden');
    el.oGrowthList.classList.remove('hidden');

    return { strengths, growth };
  };

  const renderTypesTop3 = (scores) => {
    const vec = toVec(scores);
    const top = top3Types(vec, META?.type_centroids);
    if (!top.length) return;
    el.typeCards.innerHTML = '';
    top.forEach(t=>{
      const card = document.createElement('div'); card.className='tcard';
      card.innerHTML = `<h4>${t.name} <span style="color:#9adbd4">(${(t.sim*100).toFixed(0)}%)</span></h4>
                        <p>${TYPE_DESCR[t.name] || 'Aprašymas ruošiama.'}</p>`;
      el.typeCards.appendChild(card);
    });
    el.typesHdr.classList.remove('hidden');
    el.typeCards.classList.remove('hidden');
  };

  const resetForm = () => {
    document.querySelectorAll('#itemsContainer input[type="radio"]').forEach(i => i.checked = false);
    el.tbl.classList.add('hidden');
    el.tblBody.innerHTML = '';

    [el.oStrengthHdr, el.oGrowthHdr, el.typesHdr].forEach(n=>n.classList.add('hidden'));
    [el.oStrengthList, el.oGrowthList, el.typeCards].forEach(n=>{ n.classList.add('hidden'); n.innerHTML=''; });

    el.summary.textContent = 'Užpildykite visus teiginius ir paspauskite „Gauti rezultatą“.';
    el.printActions.classList.add('hidden');
    clearError();
    scrollTo(document.body);
  };

  const init = () => {
    try {
      const raw = document.getElementById('itemsData')?.textContent?.trim();
      if (!raw) throw new Error('Nerasta inline JSON duomenų.');
      META = JSON.parse(raw);

      ITEMS = Array.isArray(META.items_full) ? META.items_full.slice() : [];
      if (ITEMS.length !== 60) console.warn('[Divirgent] Įspėjimas: teiginių skaičius ≠ 60 (dabar:', ITEMS.length, ')');

      renderForm();
    } catch (e) {
      console.error(e);
      showError(`Klaida kraunant klausimus: ${e.message}. Patikrinkite inline JSON formatą.`);
    }
  };

  // Įvykiai
  el.btnStart?.addEventListener('click', () => scrollTo(el.itemsSection));
  el.btnReset?.addEventListener('click', resetForm);
  el.btnSubmit?.addEventListener('click', () => {
    clearError();
    const resp = readResponses();
    if (!resp.ok){ showError(`Neatsakytas teiginys: ${resp.missing}. Užpildykite visus teiginius.`); return; }

    const scores = byDomain(resp.rows);
    renderScores(scores);                    // lentelė
    renderOCEANTop3(scores);                 // TOP‑3 OCEAN (stiprybės + augimas)
    renderTypesTop3(scores);                 // TOP‑3 tipai (kaip anksčiau)

    el.summary.textContent = 'Rezultatai sugeneruoti. Žemiau – OCEAN stiprybės/augimas ir tipų artimumas.';
    el.printActions.classList.remove('hidden');
    scrollTo(el.results);
  });
  document.getElementById('btnPrint')?.addEventListener('click', () => window.print());

  // Startas
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>
</body>
</html>
