<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Divirgent Test V2.2 â€“ OCEAN + tipai (LT)</title>
  <meta name="description" content="Divirgent Test â€“ Big Five (OCEAN) + tipai vieno failo testas: 60 teiginiÅ³, rezultatÅ³ skaiÄiavimas narÅ¡yklÄ—je, TOPâ€‘3 stiprybÄ—s ir augimo sritys su rekomendacijomis, tipÅ³ artimumas." />
  <meta name="color-scheme" content="dark light" />
  <style>
    /* ===========================
       Divirgent Test â€“ V2.2
       Sutvarkyta:
       - Mygtukas â€Gauti rezultatÄ…â€œ tik po paskutinio klausimo
       - Veikiantis spausdinimas (spaudoje rodoma tik rezultatÅ³ dalis)
       - Mobilui pritaikyta Likerto skalÄ— ir lipni apaÄia su progresu
       =========================== */

    :root{
      --bg:#0b1320; --fg:#e5e7eb; --muted:#9ca3af; --panel:#0f172a; --line:#1f2937;
      --c0:#0ea5e9; --c1:#22c55e; --c2:#f59e0b; --c3:#a78bfa; --c4:#ef4444;
      --tap:48px; /* min tap height */
    }
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      line-height:1.5; background:var(--bg); color:var(--fg);
    }
    .wrap{max-width:920px;margin:0 auto;padding:16px}
    h1,h2,h3{margin:.7em 0}
    .muted{color:var(--muted)}
    .kudos{font-size:12px;color:#94a3b8;margin:18px 0}

    /* VirÅ¡utinÄ— juosta (paprasta, be â€Gautiâ€œ mygtuko) */
    .topbar{
      position:sticky; top:0; z-index:10;
      background:rgba(11,19,32,0.85); backdrop-filter: saturate(1.1) blur(6px);
      border-bottom:1px solid var(--line);
    }
    .topbar .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .right{margin-left:auto}

    /* KortelÄ—s */
    .card{background:var(--panel); border:1px solid var(--line); border-radius:12px; padding:14px; margin:12px 0}

    /* Domeno Å¾yma */
    .domain-tag{display:inline-block;min-width:28px;text-align:center;padding:.1em .5em;border-radius:999px;border:1px solid var(--line);margin-right:.5em}
    .O{background:#072538;border-color:#0ea5e940}
    .C{background:#072a1f;border-color:#22c55e40}
    .E{background:#2a1d07;border-color:#f59e0b40}
    .A{background:#201b2e;border-color:#a78bfa40}
    .N{background:#2a1111;border-color:#ef444440}
    .pill{display:inline-block;padding:.2em .6em;border:1px solid var(--line);border-radius:999px;margin:.15em .25em;background:rgba(11,19,32,0.6)}

    /* Likertas â€“ segmentuotas valdiklis (patogus mobilui) */
    .item{padding:12px;border:1px dashed var(--line);border-radius:10px;background:rgba(11,19,32,0.55); margin:10px 0}
    .qtext{margin-bottom:8px}
    .scale{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .opt{position:relative}
    .opt input{position:absolute;inset:0;opacity:0}
    .opt label{
      display:flex;align-items:center;justify-content:center;flex-direction:column;gap:2px;
      min-height:var(--tap); padding:8px; border-radius:10px; border:1px solid var(--line);
      background:#111827; color:#e5e7eb; font-size:13px; user-select:none; cursor:pointer;
    }
    .opt input:focus-visible + label{outline:2px solid #60a5fa; outline-offset:2px}
    .opt input:checked + label{border-color:#22c55e; background:linear-gradient(0deg, rgba(34,197,94,0.18), rgba(34,197,94,0.18))}
    .opt .cap{font-size:11px;color:#cbd5e1}

    /* Tinklelis */
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){ .grid{grid-template-columns: 1fr 1fr} }

    /* Progreso juosta */
    .progress{height:10px;background:#111827;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--c0),var(--c1),var(--c2));width:0%}

    /* LentelÄ— rezultatams */
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid var(--line);padding:8px;text-align:left}
    .mono{font-variant-numeric:tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}
    .danger{border-color:#7f1d1d}
    .ok{border-color:#14532d}

    /* Lipni apaÄia (tik mobilui) */
    .sticky-bottom{
      position:sticky; bottom:0; z-index:9; margin-top:16px;
      background:rgba(15,23,42,0.92); backdrop-filter: blur(6px);
      border-top:1px solid var(--line); border-radius:12px 12px 0 0; padding:8px 12px;
    }
    .sticky-bottom .row{display:flex;gap:10px;align-items:center}
    .btn, button{
      background:#111827;color:var(--fg);border:1px solid #334155;border-radius:10px;
      padding:12px 14px;cursor:pointer;text-decoration:none; font-weight:600
    }
    .btn:hover, button:hover{background:#0f172a}
    .btn.secondary{background:#0b1320}

    /* Spausdinimui â€“ rodome tik rezultatus Å¡viesiame fone */
    @media print {
      :root{--bg:#ffffff;--fg:#000000;--panel:#ffffff;--line:#e5e7eb}
      body{background:#fff;color:#000}
      .topbar, .sticky-bottom, #intro, #formCard, #actionsTop, #saveNote { display:none !important; }
      #resultsCard{ border-color:#ddd; }
      a[href]:after{content:" (" attr(href) ")"; font-size:11px}
      .progress{display:none}
    }

    /* Pagalba ekranÅ³ skaitytuvams */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <!-- VirÅ¡us: tik pavadinimas ir progresas -->
  <header class="topbar">
    <div class="wrap">
      <div class="row">
        <div><strong>Divirgent Test V2.2 â€“ OCEAN + tipai (LT)</strong></div>
        <span class="muted"> ~8â€“10 min Â· 60 teiginiÅ³ Â· skaiÄiuojama narÅ¡yklÄ—je</span>
        <span class="right muted" id="saveNote">Atsakymai saugomi Å¡iame Ä¯renginyje</span>
      </div>
      <div class="progress" aria-label="Bendras progresas">
        <div class="bar" id="progressBar" style="width:0%"></div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Ä®Å¾anga -->
    <section id="intro" class="card">
      <h1>Divirgent Test â€“ Big Five (OCEAN) + tipai</h1>
      <p class="muted">Likertas: 1 â€“ VisiÅ¡kai nesutinku Â· 5 â€“ VisiÅ¡kai sutinku. Invertuoti teiginiai skaiÄiuojami prieÅ¡ingai.</p>
      <noscript><p style="color:#ef4444"><strong>Å iam testui reikia JavaScript.</strong> Ä®junkite JavaScript narÅ¡yklÄ—je.</p></noscript>
    </section>

    <!-- Forma su visais klausimais; PAGRINDINIS SUBMIT MYGTUKAS APAÄŒIOJE -->
    <section id="formCard" class="card">
      <h2>Teiginiai</h2>
      <form id="testForm" novalidate>
        <div id="itemsHost" class="grid" role="group" aria-describedby="likertHelp"></div>
        <p id="likertHelp" class="sr-only">Kiekvienam teiginiui pasirinkite atsakymÄ… skalÄ—je nuo 1 iki 5.</p>

        <!-- Lipni apaÄia: mobilus progresas + nuoroda Ä¯ pirmÄ… neuÅ¾pildytÄ… -->
        <div class="sticky-bottom" aria-live="polite">
          <div class="row">
            <span class="muted" id="progressText">0 / 60</span>
            <button type="button" class="btn secondary" id="gotoNextBtn">Ä® neuÅ¾pildytÄ…</button>
            <span class="right"></span>
          </div>
        </div>

        <!-- PAGRINDINIS CTA (vienintelis) â€“ PO PASKUTINIO KLAUSIMO -->
        <div style="margin-top:14px; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
          <button id="submitBtn" type="submit" class="btn">Gauti rezultatÄ…</button>
          <button id="clearBtn" type="button" class="btn secondary">IÅ¡valyti</button>
          <span id="fillAllNote" class="muted">UÅ¾pildykite visus teiginius ir spauskite â€Gauti rezultatÄ…â€œ.</span>
        </div>
      </form>
    </section>

    <!-- Rezultatai -->
    <section id="resultsCard" class="card" hidden>
      <h2>Rezultatai</h2>
      <div class="grid">
        <div>
          <h3>LentelÄ—</h3>
          <table id="resTable" aria-describedby="resHelp">
            <thead>
              <tr>
                <th>Domenas</th>
                <th>Vidurkis (1â€“5)</th>
                <th>Normalizuota (â€“1â€¦+1)</th>
                <th>%</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <p id="resHelp" class="sr-only">LentelÄ—je rodomi penkiÅ³ domenÅ³ rezultatai.</p>
        </div>

        <div>
          <h3>TOPâ€‘3 stiprybÄ—s</h3>
          <div id="strengths"></div>

          <h3 style="margin-top:12px">TOPâ€‘3 augimo sritys</h3>
          <div id="growth"></div>

          <h3 style="margin-top:12px">TipÅ³ artimumas (TOPâ€‘3)</h3>
          <div id="typesTop"></div>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap">
            <button type="button" id="printBtn" class="btn">Spausdinti PDF</button>
            #formCardGrÄ¯Å¾ti prie teiginiÅ³</a>
          </div>
        </div>
      </div>

      <p class="kudos">Â© 2025 Divirgent Test Â· </p>
    </section>
  </main>

  <!-- Logika -->
  <script>
  /* ====== 1) Modelis ====== */
  const DOMAINS = {
    O: { name: "Atvirumas (O)", color: "O" },
    C: { name: "Pareigingumas (C)", color: "C" },
    E: { name: "EkstravertiÅ¡kumas (E)", color: "E" },
    A: { name: "Sutariamumas (A)", color: "A" },
    N: { name: "NeurotiÅ¡kumas (N)", color: "N" }
  };

  const ITEMS = [
    /* O */
    {id:"O1", d:"O", t:"MÄ—gstu tyrinÄ—ti naujas idÄ—jas ir koncepcijas.", invert:false},
    {id:"O2", d:"O", t:"DaÅ¾nai svajoju ir Ä¯sivaizduoju galimus scenarijus.", invert:false},
    {id:"O3", d:"O", t:"MÄ—gstu meno, muzikos ar literatÅ«ros Ä¯vairovÄ™.", invert:false},
    {id:"O4", d:"O", t:"Rutina man teikia daugiau saugumo nei naujovÄ—s.", invert:true},
    {id:"O5", d:"O", t:"Greitai perprantu abstrakÄias idÄ—jas.", invert:false},
    {id:"O6", d:"O", t:"Vengiu netikrumo ir neapibrÄ—Å¾tumo.", invert:true},
    {id:"O7", d:"O", t:"Smalsiai bandau naujus metodus ar Ä¯rankius.", invert:false},
    {id:"O8", d:"O", t:"Man labiau patinka paÅ¾Ä¯stami marÅ¡rutai ir vietos.", invert:true},
    {id:"O9", d:"O", t:"Lengvai prisitaikau prie pokyÄiÅ³.", invert:false},
    {id:"O10", d:"O", t:"NejauÄiu poreikio mokytis dalykÅ³ uÅ¾ mano srities ribÅ³.", invert:true},
    {id:"O11", d:"O", t:"KÅ«rybinÄ—s uÅ¾duotys mane Ä¯kvepia.", invert:false},
    {id:"O12", d:"O", t:"NedÅ¾iugina nauji skoniai, Å¾anrai ar stiliai.", invert:true},
    /* C */
    {id:"C1", d:"C", t:"TvarkÄ… ir planÄ… laikau svarbiais kasdien.", invert:false},
    {id:"C2", d:"C", t:"DaÅ¾nai atidÄ—lioju svarbias uÅ¾duotis.", invert:true},
    {id:"C3", d:"C", t:"Laikausi terminÅ³ ir Ä¯sipareigojimÅ³.", invert:false},
    {id:"C4", d:"C", t:"Mano darbo vieta daÅ¾niausiai netvarkinga.", invert:true},
    {id:"C5", d:"C", t:"Dirbu nuosekliai ir sistemiÅ¡kai.", invert:false},
    {id:"C6", d:"C", t:"Smulkmenos man neretai â€praslysta pro akisâ€œ.", invert:true},
    {id:"C7", d:"C", t:"UÅ¾baigiu tai, kÄ… pradedu.", invert:false},
    {id:"C8", d:"C", t:"MÄ—gstu veikti spontaniÅ¡kai, be plano.", invert:true},
    {id:"C9", d:"C", t:"Lengvai laikau prioritetus esant dideliam krÅ«viui.", invert:false},
    {id:"C10", d:"C", t:"DaÅ¾nai pametu gijas arba praleidÅ¾iu svarbiÄ… smulkmenÄ….", invert:true},
    {id:"C11", d:"C", t:"Esu patikimas(-a) ir atsakingas(-a).", invert:false},
    {id:"C12", d:"C", t:"TaisyklÄ—s daÅ¾niausiai trukdo ir jas apeinu.", invert:true},
    /* E */
    {id:"E1", d:"E", t:"PradÄ—ti pokalbÄ¯ su nepaÅ¾Ä¯stamais man lengva.", invert:false},
    {id:"E2", d:"E", t:"DidelÄ—s Å¾moniÅ³ grupÄ—s mane vargina.", invert:true},
    {id:"E3", d:"E", t:"MÄ—gstu bÅ«ti dÄ—mesio centre.", invert:false},
    {id:"E4", d:"E", t:"GreiÄiau renkuosi vienatvÄ™, nei Å¡urmulÄ¯.", invert:true},
    {id:"E5", d:"E", t:"Esu energingas(-a) ir gyvas(-a) bendraujant.", invert:false},
    {id:"E6", d:"E", t:"Esu santÅ«rus(-i) ir maÅ¾ai kalbus(-i).", invert:true},
    {id:"E7", d:"E", t:"Greitai uÅ¾mezgu ryÅ¡Ä¯ su Å¾monÄ—mis.", invert:false},
    {id:"E8", d:"E", t:"Retai imuosi iniciatyvos socialinÄ—se situacijose.", invert:true},
    {id:"E9", d:"E", t:"Man patinka komandinÄ—s veiklos ir renginiai.", invert:false},
    {id:"E10", d:"E", t:"DaÅ¾niau stebiu, nei Ä¯sitraukiu.", invert:true},
    {id:"E11", d:"E", t:"Balsas ir kÅ«no kalba pas mane ryÅ¡ki.", invert:false},
    {id:"E12", d:"E", t:"Vengiu skambuÄiÅ³ ar spontaniÅ¡kÅ³ susitikimÅ³.", invert:true},
    /* A */
    {id:"A1", d:"A", t:"Lengvai Ä¯sijauÄiu Ä¯ kitÅ³ Å¾moniÅ³ jausmus.", invert:false},
    {id:"A2", d:"A", t:"DaÅ¾nai ginÄijuosi dÄ—l principÅ³.", invert:true},
    {id:"A3", d:"A", t:"Stengiuosi bendradarbiauti ir ieÅ¡koti winâ€‘win.", invert:false},
    {id:"A4", d:"A", t:"Esu tiesmukas(-a) net kai tai Å¾eidÅ¾ia.", invert:true},
    {id:"A5", d:"A", t:"Lengvai atleidÅ¾iu ir judu toliau.", invert:false},
    {id:"A6", d:"A", t:"KitÅ³ ketinimus vertinu su nepasitikÄ—jimu.", invert:true},
    {id:"A7", d:"A", t:"Man svarbu kurti gerÄ… atmosferÄ… komandoje.", invert:false},
    {id:"A8", d:"A", t:"KritikÄ… reiÅ¡kiu grieÅ¾tai, be uÅ¾uolankÅ³.", invert:true},
    {id:"A9", d:"A", t:"Lengvai nusileidÅ¾iu smulkmenose dÄ—l bendro tikslo.", invert:false},
    {id:"A10", d:"A", t:"DaÅ¾nai pirma galvoju apie save, o ne apie kitus.", invert:true},
    {id:"A11", d:"A", t:"Esu mandagus(-i) ir pagarbus(-i) net esant Ä¯tampai.", invert:false},
    {id:"A12", d:"A", t:"Rungtyniauju labiau nei bendradarbiauju.", invert:true},
    /* N */
    {id:"N1", d:"N", t:"Lengvai imu nerimauti dÄ—l Ä¯vairiÅ³ dalykÅ³.", invert:false},
    {id:"N2", d:"N", t:"IÅ¡laikau ramybÄ™ netikÄ—tose situacijose.", invert:true},
    {id:"N3", d:"N", t:"Stresas mane greitai iÅ¡muÅ¡a iÅ¡ vÄ—Å¾iÅ³.", invert:false},
    {id:"N4", d:"N", t:"Retai pergyvenu dÄ—l klaidÅ³.", invert:true},
    {id:"N5", d:"N", t:"Emocijos svyruoja daÅ¾niau nei norÄ—Äiau.", invert:false},
    {id:"N6", d:"N", t:"KritikÄ… priimu be didelio sukrÄ—timo.", invert:true},
    {id:"N7", d:"N", t:"Kartais sunku atsipalaiduoti.", invert:false},
    {id:"N8", d:"N", t:"Miegas ir apetitas beveik visada stabilÅ«s.", invert:true},
    {id:"N9", d:"N", t:"DaÅ¾nai â€pergalvojuâ€œ praeitus Ä¯vykius.", invert:false},
    {id:"N10", d:"N", t:"Retai jauÄiu Ä¯tampÄ… ar nerimÄ….", invert:true},
    {id:"N11", d:"N", t:"StaigÅ«s pokyÄiai mane Ä¯audrina.", invert:false},
    {id:"N12", d:"N", t:"IÅ¡lieku stabilus(-i), kai kiti jaudinasi.", invert:true}
  ];

  const TYPES = [
    { name:"DirigentÄ—",  v:{O: 0.3, C: 0.7, E: 0.5, A:-0.1, N:-0.4} },
    { name:"Strategas",   v:{O: 0.6, C: 0.8, E: 0.0, A: 0.2, N:-0.3} },
    { name:"TyrinÄ—tojas", v:{O: 0.9, C: 0.1, E:  0.1, A: 0.2, N: 0.0} },
    { name:"Diplomatas",  v:{O: 0.4, C: 0.5, E:  0.2, A: 0.8, N:-0.2} },
    { name:"Iniciatorius",v:{O: 0.5, C: 0.4, E:  0.8, A: 0.1, N: 0.1} },
    { name:"Analitikas",  v:{O: 0.7, C: 0.7, E: -0.2, A: 0.0, N:-0.2} },
    { name:"RÄ—mÄ—jas",     v:{O: 0.2, C: 0.6, E:  0.3, A: 0.9, N:-0.4} },
    { name:"Novatorius",  v:{O: 0.8, C: 0.3, E:  0.5, A:-0.1, N: 0.0} }
  ];

  const RECS = {
    O: [
      "KiekvienÄ… savaitÄ™ iÅ¡bandyk 1 naujÄ… metodÄ…/Ä¯rankÄ¯ ir uÅ¾raÅ¡yk 3 Ä¯Å¾valgas.",
      "Planuok 2 val. â€mokymosi langÄ…â€œ â€“ kursas, straipsniai, praktika.",
      "PerÅ¾iÅ«rÄ—k 1 procesÄ… ir pasiÅ«lyk maÅ¾Ä… eksperimentÄ… (A/B)."
    ],
    C: [
      "Naudok 2â€‘min taisyklÄ™: jei uÅ¾duotis <2 min â€“ atlik dabar.",
      "Dienos TOPâ€‘3: ryte uÅ¾raÅ¡yk 3 svarbiausias uÅ¾duotis ir paÅ¾ymÄ—k terminus.",
      "Savaitinis â€uÅ¾darymoâ€œ ritualas: sutvarkyk sÄ…raÅ¡us, stalÄiÅ³, kalendoriÅ³."
    ],
    E: [
      "KiekvienÄ… dienÄ… pradÄ—k 1 trumpÄ… pokalbÄ¯ (ğŸ‘‹, klausimas, padÄ—ka).",
      "KartÄ… per savaitÄ™ vesk miniâ€‘susitikimÄ… arba pasidalink Ä¯Å¾valga komandoje.",
      "Praktikuok â€atvirÄ… pozÄ…â€œ: akisâ€‘akis, nugarÄ… tiesiai, aiÅ¡kus balsas."
    ],
    A: [
      "Ä®diek â€veidrodÅ¾ioâ€œ principÄ…: pirmiausia perfrazuok, kÄ… iÅ¡girdai.",
      "Konfliktuose ieÅ¡kok 1 bendro intereso ir 1 maÅ¾o kompromiso.",
      "Duok 1 nuoÅ¡irdÅ³ komplimentÄ… ar padÄ—kÄ… kasdien."
    ],
    N: [
      "3â€‘3â€‘3 nerimo pratimas: 3 dalykai matomi, 3 girdimi, 3 jauÄiami.",
      "Ä®sivesk â€buferÄ¯â€œ: 10 min. tarp susitikimÅ³ kvÄ—pavimui ar pasivaikÅ¡Äiojimui.",
      "Vakare suraÅ¡yk 3 tikslus rytdienai â€“ maÅ¾ina galvos â€sukimÄ…â€œ."
    ]
  };

  /* ====== 2) PagalbinÄ—s ====== */
  const by = (s, r=document)=>r.querySelector(s);
  const el = (tag, attrs={}, ...kids)=>{
    const n = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (k==="class") n.className = v;
      else if (k==="html") n.innerHTML = v;
      else if (k.startsWith("on")) n.addEventListener(k.slice(2), v);
      else n.setAttribute(k, v);
    }
    for (const k of kids){ n.appendChild(typeof k==="string" ? document.createTextNode(k) : k); }
    return n;
  };
  const mean = a => a.reduce((x,y)=>x+y,0) / (a.length||1);
  const fmt = (n,d=2)=>Number(n).toFixed(d);
  const normFromAvg = a => (a - 3) / 2;
  const pctFromAvg  = a => ((a - 1) / 4) * 100;
  const cosineSim = (a,b)=>{
    const ks=["O","C","E","A","N"]; let dot=0, na=0, nb=0;
    for (const k of ks){ dot+=a[k]*b[k]; na+=a[k]*a[k]; nb+=b[k]*b[k]; }
    return (na===0||nb===0)?0: dot / Math.sqrt(na*nb);
  };

  /* ====== 3) UI generavimas ====== */
  function renderLikert(id){
    const wrap = el("div",{class:"scale", role:"radiogroup","aria-labelledby":id});
    const caps = {1:"VisiÅ¡kai nesutinku",2:"Nesutinku",3:"Neutrali(-us)",4:"Sutinku",5:"VisiÅ¡kai sutinku"};
    for(let v=1; v<=5; v++){
      const rid = `${id}_${v}`;
      wrap.appendChild(
        el("div",{class:"opt"},
          el("input",{type:"radio", name:id, id:rid, value:String(v), required:true, onChange:onAnswer}),
          el("label",{for:rid},
            el("span",{}, String(v)),
            el("span",{class:"cap"}, caps[v])
          )
        )
      );
    }
    return wrap;
  }

  function renderForm(){
    const host = by("#itemsHost"); host.innerHTML="";
    const groups = {O:[],C:[],E:[],A:[],N:[]}; ITEMS.forEach(i=>groups[i.d].push(i));
    for (const d of ["O","C","E","A","N"]){
      const card = el("section",{class:"card", id:`sec-${d}`},
        el("h3",{}, el("span",{class:`domain-tag ${d}`}, d), " ", DOMAINS[d].name)
      );
      for (const it of groups[d]){
        const item = el("fieldset",{class:"item", id:`item-${it.id}`},
          el("legend",{class:"qtext"},
            el("span",{class:"pill"}, it.id), " ",
            it.t, " ",
            it.invert ? el("span",{class:"muted"},"(invertuotas)") : ""
          ),
          renderLikert(it.id)
        );
        card.appendChild(item);
      }
      host.appendChild(card);
    }
  }

  /* ====== 4) Duomenys ir skaiÄiavimai ====== */
  function collectAnswers(){
    const out={};
    for (const it of ITEMS){
      const ch = document.querySelector(`input[name="${it.id}"]:checked`);
      out[it.id] = ch ? Number(ch.value) : null;
    }
    return out;
  }
  function invert(v, inv){ return v==null?null : (inv ? 6 - v : v); }

  function calcScores(){
    const ans = collectAnswers();
    const buckets = {O:[],C:[],E:[],A:[],N:[]};
    let answered = 0;
    for (const it of ITEMS){
      const v = invert(ans[it.id], it.invert);
      if (v!=null){ buckets[it.d].push(v); answered++; }
    }
    const scores={};
    for (const k of Object.keys(buckets)){
      const arr = buckets[k];
      const avg = arr.length ? mean(arr) : null;
      scores[k] = {
        avg, norm: avg==null?null:normFromAvg(avg),
        pct: avg==null?null:pctFromAvg(avg),
        count: arr.length
      };
    }
    return {scores, answered, total:ITEMS.length};
  }

  function renderResults(model){
    const order=["O","C","E","A","N"];
    // LentelÄ—
    const tbody = by("#resTable tbody"); tbody.innerHTML="";
    for (const d of order){
      const s = model.scores[d];
      const tr = el("tr",{},
        el("td",{}, el("span",{class:`domain-tag ${d}`}, d), " ", DOMAINS[d].name),
        el("td",{class:"mono"}, s.avg==null?"â€“":fmt(s.avg,2)),
        el("td",{class:"mono"}, s.norm==null?"â€“":(s.norm>=0?"+":"")+fmt(s.norm,2)),
        el("td",{class:"mono"}, s.pct==null?"â€“":fmt(s.pct,0)+"%")
      );
      tbody.appendChild(tr);
    }

    // TOPâ€‘3 stiprybÄ—s / augimo
    const arr = order.map(d=>({d, ...model.scores[d]})).filter(x=>x.pct!=null).sort((a,b)=>b.pct-a.pct);
    const strengths = arr.slice(0,3);
    const growth = arr.slice(-3).reverse();

    const sBox = by("#strengths"); sBox.innerHTML="";
    strengths.forEach(x=>{
      sBox.appendChild(el("div",{},
        el("span",{class:`domain-tag ${x.d}`}, x.d), " ",
        DOMAINS[x.d].name, " Â· ",
        el("strong",{}, fmt(x.pct,0)+"%")
      ));
    });

    const gBox = by("#growth"); gBox.innerHTML="";
    growth.forEach(x=>{
      gBox.appendChild(
        el("div",{class:`item ${x.pct<40?'danger': (x.pct<60?'': 'ok')}`},
          el("div",{}, el("span",{class:`domain-tag ${x.d}`}, x.d), " ",
            DOMAINS[x.d].name, " Â· ", el("strong",{}, fmt(x.pct,0)+"%")),
          el("ul",{}, ...RECS[x.d].map(r=>el("li",{}, r)))
        )
      );
    });

    // TipÅ³ artimumas
    const self={}; order.forEach(d=>self[d]=model.scores[d].norm ?? 0);
    const typed = TYPES.map(t=>{
      const sim = cosineSim(self, t.v);
      return {name:t.name, pct: Math.round(((sim+1)/2)*100)};
    }).sort((a,b)=>b.pct-a.pct).slice(0,3);

    const tBox = by("#typesTop"); tBox.innerHTML="";
    typed.forEach(t=> tBox.appendChild(el("div",{}, el("span",{class:"pill"}, t.name), " Â· artimumas ", el("strong",{}, t.pct+"%"))));
  }

  /* ====== 5) UX: progresas, validacija, narÅ¡ymas ====== */
  function firstUnanswered(){
    for (const it of ITEMS){
      const chk = document.querySelector(`input[name="${it.id}"]:checked`);
      if (!chk) return it.id;
    }
    return null;
  }
  function scrollToQuestion(id){
    const node = by(`#item-${id}`); if (!node) return;
    const top = node.getBoundingClientRect().top + window.scrollY - 72;
    window.scrollTo({top, behavior:"smooth"});
    node.style.borderColor="#7c3aed";
    setTimeout(()=>node.style.borderColor="", 1200);
  }

  function updateProgressUI(){
    const model = calcScores();
    by("#progressBar").style.width = Math.round(model.answered/model.total*100) + "%";
    by("#progressText").textContent = `${model.answered} / ${model.total}`;
    return model;
  }

  function highlightMissing(){
    for (const it of ITEMS){
      const answered = !!document.querySelector(`input[name="${it.id}"]:checked`);
      const node = by(`#item-${it.id}`);
      if (node) node.style.borderColor = answered ? "var(--line)" : "#7f1d1d";
    }
  }

  /* ====== 6) Saugojimas ====== */
  const STORAGE_KEY = "divirgent_ocean_answers_v22";
  function save(){
    const ans = collectAnswers();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(ans));
  }
  function restore(){
    const raw = localStorage.getItem(STORAGE_KEY); if (!raw) return;
    try{
      const ans = JSON.parse(raw) || {};
      Object.entries(ans).forEach(([id,val])=>{
        if (val==null) return;
        const el = document.querySelector(`input[name="${id}"][value="${val}"]`);
        if (el) el.checked = true;
      });
    }catch(e){}
  }
  function clearAll(){
    localStorage.removeItem(STORAGE_KEY);
    for (const it of ITEMS){
      const chk = document.querySelector(`input[name="${it.id}"]:checked`);
      if (chk) chk.checked = false;
    }
    updateProgressUI();
    highlightMissing();
  }

  /* ====== 7) Ä®vykiai ====== */
  function onAnswer(){
    save();
    updateProgressUI();
  }

  function onSubmit(e){
    e.preventDefault();
    const model = updateProgressUI();
    if (model.answered < model.total){
      const rest = model.total - model.answered;
      by("#fillAllNote").textContent = `UÅ¾pildykite visus teiginius. TrÅ«ksta: ${rest}.`;
      highlightMissing();
      const id = firstUnanswered(); if (id) scrollToQuestion(id);
      return;
    }
    by("#fillAllNote").textContent = "Rezultatai apskaiÄiuoti.";
    renderResults(model);
    by("#resultsCard").hidden = false;
    // slenkame prie rezultatÅ³
    const top = by("#resultsCard").getBoundingClientRect().top + window.scrollY - 70;
    window.scrollTo({top, behavior:"smooth"});
  }

  function onPrint(){ window.print(); }

  /* ====== 8) Startas ====== */
  function boot(){
    renderForm();
    restore();
    updateProgressUI();

    by("#testForm").addEventListener("submit", onSubmit);
    by("#clearBtn").addEventListener("click", ()=>{ clearAll(); by("#fillAllNote").textContent="UÅ¾pildykite visus teiginius ir spauskite â€Gauti rezultatÄ…â€œ."; });
    by("#gotoNextBtn").addEventListener("click", ()=>{ const id=firstUnanswered(); if(id) scrollToQuestion(id); });
    by("#printBtn").addEventListener("click", onPrint);
  }
  document.addEventListener("DOMContentLoaded", boot);
  </script>
</body>
</html>
``
