<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Divirgent Test V2.1 â€“ OCEAN (LT)</title>
  <meta name="description" content="Divirgent Test V2.1 â€“ Big Five (OCEAN) vieno failo testas: 60 teiginiÅ³, rezultatai narÅ¡yklÄ—je, TOPâ€‘3 stiprybÄ—s ir augimo sritys su rekomendacijomis, tipÅ³ artimumas." />
  <meta name="color-scheme" content="dark light" />
  <style>
    /* ===========================
       Divirgent Test â€“ vieno failo stiliai
       Versija: 2.1
       =========================== */
    :root{--c0:#0ea5e9;--c1:#22c55e;--c2:#f59e0b;--c3:#a78bfa;--c4:#ef4444;--bg:#0b1320;--fg:#e5e7eb;--muted:#9ca3af;--panel:#0f172a;--line:#1f2937}
    html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;line-height:1.45;margin:0;background:var(--bg);color:var(--fg)}
    .wrap{max-width:980px;margin:24px auto;padding:16px}
    h1,h2,h3{margin:0.6em 0}
    .topbar{position:sticky;top:0;background:rgba(11,19,32,0.85);backdrop-filter:saturate(1.2) blur(6px);padding:10px 0;border-bottom:1px solid var(--line);z-index:10}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
    button, .btn{background:#111827;color:var(--fg);border:1px solid #334155;border-radius:8px;padding:10px 14px;cursor:pointer;text-decoration:none}
    button:hover,.btn:hover{background:#0f172a}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    .card{border:1px solid var(--line);border-radius:12px;padding:14px;background:var(--panel)}
    .domain{font-weight:600}
    .item{padding:12px;border:1px dashed var(--line);border-radius:10px;background:rgba(11,19,32,0.6)}
    .scale{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px}
    .scale label{display:flex;flex-direction:column;align-items:center;font-size:12px;color:#cbd5e1}
    .scale input{accent-color:#22c55e;cursor:pointer}
    .progress{height:10px;background:#111827;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--c0),var(--c1),var(--c2));width:0%}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid var(--line);padding:8px;text-align:left}
    .mono{font-variant-numeric:tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}
    .pill{display:inline-block;padding:.2em .6em;border:1px solid var(--line);border-radius:999px;margin:.15em .25em;background:rgba(11,19,32,0.6)}
    .kudos{font-size:12px;color:#94a3b8;margin-top:16px}
    .domain-tag{display:inline-block;min-width:28px;text-align:center;padding:.1em .5em;border-radius:999px;border:1px solid var(--line);margin-right:.5em}
    .O{background:#072538;border-color:#0ea5e940}
    .C{background:#072a1f;border-color:#22c55e40}
    .E{background:#2a1d07;border-color:#f59e0b40}
    .A{background:#201b2e;border-color:#a78bfa40}
    .N{background:#2a1111;border-color:#ef444440}
    .inline-note{font-size:12px;color:#a1a1aa}
    .flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .right{margin-left:auto}
    .danger{border-color:#7f1d1d}
    .ok{border-color:#14532d}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    @media(min-width:900px){
      .grid{grid-template-columns: 1fr 1fr}
    }

    /* Spausdinimui â€“ Å¡viesus fonas ir juodas tekstas */
    @media print {
      :root{--bg:#ffffff;--fg:#000000;--panel:#ffffff;--line:#e5e7eb}
      body{background:#fff;color:#000}
      .topbar{position:static;background:#fff;border-bottom:1px solid #e5e7eb}
      button, .btn, .actions a{display:none!important}
      .item{background:#fff;border-color:#e5e7eb}
      .kudos{color:#555}
      .progress{display:none}
      a[href]:after{content:" (" attr(href) ")"; font-size:11px}
    }
  </style>
</head>
<body>
  <!-- VirÅ¡us: sticky navigacija ir veiksmai -->
  <div class="topbar">
    <div class="wrap">
      <div class="flex">
        <div><strong>Divirgent Test V2.1 â€“ OCEAN (LT)</strong></div>
        <span class="inline-note"> ~8â€“10 min Â· 60 teiginiÅ³ Â· be prisijungimo Â· skaiÄiuojama narÅ¡yklÄ—je</span>
        <span class="right inline-note">PDF: naudok narÅ¡yklÄ—s â€IÅ¡saugoti kaip PDFâ€œ</span>
      </div>
      <div class="actions">
        #teiginiaiPereiti prie teiginiÅ³</a>
        <button id="calcBtn" type="button">Gauti rezultatÄ…</button>
        <button id="clearBtn" type="button">IÅ¡valyti</button>
      </div>
    </div>
  </div>

  <!-- Ä®Å¾anga -->
  <main class="wrap" id="intro">
    <h1>Divirgent Test V2.1 â€“ OCEAN (LT)</h1>
    <p class="muted">Likertas: 1 â€“ VisiÅ¡kai nesutinku Â· 5 â€“ VisiÅ¡kai sutinku. Invertuoti teiginiai skaiÄiuojami prieÅ¡ingai.</p>
    <noscript><p style="color:#ef4444"><strong>Å iam testui reikia JavaScript.</strong> Ä®junkite JavaScript narÅ¡yklÄ—je.</p></noscript>
  </main>

  <!-- Teiginiai (dinamiÅ¡kai sugeneruojami) -->
  <section class="wrap" id="teiginiai" aria-labelledby="hdr-teiginiai">
    <h2 id="hdr-teiginiai">Teiginiai</h2>
    <div id="itemsHost" class="grid" role="group" aria-describedby="likertHelp"></div>
    <p id="likertHelp" class="sr-only">Kiekvienam teiginiui pasirinkite atsakymÄ… skalÄ—je nuo 1 iki 5.</p>
  </section>

  <!-- Rezultatai -->
  <section class="wrap" id="results" aria-labelledby="hdr-rezultatai">
    <h2 id="hdr-rezultatai">Rezultatai</h2>
    <p id="fillAllNote" class="muted">UÅ¾pildykite visus teiginius ir paspauskite â€Gauti rezultatÄ…â€œ.</p>

    <div class="grid">
      <div class="card">
        <h3>LentelÄ—</h3>
        <div class="progress" title="Bendras uÅ¾pildymo progresas">
          <div class="bar" id="progressBar" style="width:0%"></div>
        </div>
        <table id="resTable">
          <thead>
            <tr>
              <th>Domenas</th>
              <th>Vidurkis (1â€“5)</th>
              <th>Normalizuota (â€“1â€¦+1)</th>
              <th>%</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card">
        <h3>TOPâ€‘3 stiprybÄ—s (OCEAN)</h3>
        <div id="strengths"></div>
        <h3>TOPâ€‘3 augimo sritys</h3>
        <div id="growth"></div>
        <h3>TipÅ³ artimumas (TOPâ€‘3)</h3>
        <div id="typesTop"></div>
      </div>
    </div>

    <div class="kudos">Â© 2025 Divirgent Test Â· Vieno failo versija (index.html)</div>
  </section>

  <!-- ===========================
       JavaScript logika
       =========================== -->
  <script>
  /* ====== 1) Modelis: domenai, teiginiai, tipai, rekomendacijos ====== */
  const DOMAINS = {
    O: { name: "Atvirumas (O)", color: "O" },
    C: { name: "Pareigingumas (C)", color: "C" },
    E: { name: "EkstravertiÅ¡kumas (E)", color: "E" },
    A: { name: "Sutariamumas (A)", color: "A" },
    N: { name: "NeurotiÅ¡kumas (N)", color: "N" }
  };

  /* 60 teiginiÅ³ (12Ã—5). invert: true reiÅ¡kia atvirkÅ¡tinis skaiÄiavimas. */
  const ITEMS = [
    /* O: Atvirumas (12) */
    {id:"O1", d:"O", t:"MÄ—gstu tyrinÄ—ti naujas idÄ—jas ir koncepcijas.", invert:false},
    {id:"O2", d:"O", t:"DaÅ¾nai svajoju ir Ä¯sivaizduoju galimus scenarijus.", invert:false},
    {id:"O3", d:"O", t:"MÄ—gstu meno, muzikos ar literatÅ«ros Ä¯vairovÄ™.", invert:false},
    {id:"O4", d:"O", t:"Rutina man teikia daugiau saugumo nei naujovÄ—s.", invert:true},
    {id:"O5", d:"O", t:"Greitai perprantu abstrakÄias idÄ—jas.", invert:false},
    {id:"O6", d:"O", t:"Vengiu netikrumo ir neapibrÄ—Å¾tumo.", invert:true},
    {id:"O7", d:"O", t:"Smalsiai bandau naujus metodus ar Ä¯rankius.", invert:false},
    {id:"O8", d:"O", t:"Man labiau patinka paÅ¾Ä¯stami marÅ¡rutai ir vietos.", invert:true},
    {id:"O9", d:"O", t:"Lengvai prisitaikau prie pokyÄiÅ³.", invert:false},
    {id:"O10", d:"O", t:"NejauÄiu poreikio mokytis dalykÅ³ uÅ¾ mano srities ribÅ³.", invert:true},
    {id:"O11", d:"O", t:"KÅ«rybinÄ—s uÅ¾duotys mane Ä¯kvepia.", invert:false},
    {id:"O12", d:"O", t:"NedÅ¾iugina nauji skoniai, Å¾anrai ar stiliai.", invert:true},

    /* C: Pareigingumas (12) */
    {id:"C1", d:"C", t:"TvarkÄ… ir planÄ… laikau svarbiais kasdien.", invert:false},
    {id:"C2", d:"C", t:"DaÅ¾nai atidÄ—lioju svarbias uÅ¾duotis.", invert:true},
    {id:"C3", d:"C", t:"Laikausi terminÅ³ ir Ä¯sipareigojimÅ³.", invert:false},
    {id:"C4", d:"C", t:"Mano darbo vieta daÅ¾niausiai netvarkinga.", invert:true},
    {id:"C5", d:"C", t:"Dirbu nuosekliai ir sistemiÅ¡kai.", invert:false},
    {id:"C6", d:"C", t:"Smulkmenos man neretai â€praslysta pro akisâ€œ.", invert:true},
    {id:"C7", d:"C", t:"UÅ¾baigiu tai, kÄ… pradedu.", invert:false},
    {id:"C8", d:"C", t:"MÄ—gstu veikti spontaniÅ¡kai, be plano.", invert:true},
    {id:"C9", d:"C", t:"Lengvai laikau prioritetus esant dideliam krÅ«viui.", invert:false},
    {id:"C10", d:"C", t:"DaÅ¾nai pametu gijas arba praleidÅ¾iu svarbiÄ… smulkmenÄ….", invert:true},
    {id:"C11", d:"C", t:"Esu patikimas(-a) ir atsakingas(-a).", invert:false},
    {id:"C12", d:"C", t:"TaisyklÄ—s daÅ¾niausiai trukdo ir jas apeinu.", invert:true},

    /* E: EkstravertiÅ¡kumas (12) */
    {id:"E1", d:"E", t:"PradÄ—ti pokalbÄ¯ su nepaÅ¾Ä¯stamais man lengva.", invert:false},
    {id:"E2", d:"E", t:"DidelÄ—s Å¾moniÅ³ grupÄ—s mane vargina.", invert:true},
    {id:"E3", d:"E", t:"MÄ—gstu bÅ«ti dÄ—mesio centre.", invert:false},
    {id:"E4", d:"E", t:"GreiÄiau renkuosi vienatvÄ™, nei Å¡urmulÄ¯.", invert:true},
    {id:"E5", d:"E", t:"Esu energingas(-a) ir gyvas(-a) bendraujant.", invert:false},
    {id:"E6", d:"E", t:"Esu santÅ«rus(-i) ir maÅ¾ai kalbus(-i).", invert:true},
    {id:"E7", d:"E", t:"Greitai uÅ¾mezgu ryÅ¡Ä¯ su Å¾monÄ—mis.", invert:false},
    {id:"E8", d:"E", t:"Retai imuosi iniciatyvos socialinÄ—se situacijose.", invert:true},
    {id:"E9", d:"E", t:"Man patinka komandinÄ—s veiklos ir renginiai.", invert:false},
    {id:"E10", d:"E", t:"DaÅ¾niau stebiu, nei Ä¯sitraukiu.", invert:true},
    {id:"E11", d:"E", t:"Balsas ir kÅ«no kalba pas mane ryÅ¡ki.", invert:false},
    {id:"E12", d:"E", t:"Vengiu skambuÄiÅ³ ar spontaniÅ¡kÅ³ susitikimÅ³.", invert:true},

    /* A: Sutariamumas (12) */
    {id:"A1", d:"A", t:"Lengvai Ä¯sijauÄiu Ä¯ kitÅ³ Å¾moniÅ³ jausmus.", invert:false},
    {id:"A2", d:"A", t:"DaÅ¾nai ginÄijuosi dÄ—l principÅ³.", invert:true},
    {id:"A3", d:"A", t:"Stengiuosi bendradarbiauti ir ieÅ¡koti winâ€‘win.", invert:false},
    {id:"A4", d:"A", t:"Esu tiesmukas(-a) net kai tai Å¾eidÅ¾ia.", invert:true},
    {id:"A5", d:"A", t:"Lengvai atleidÅ¾iu ir judu toliau.", invert:false},
    {id:"A6", d:"A", t:"KitÅ³ ketinimus vertinu su nepasitikÄ—jimu.", invert:true},
    {id:"A7", d:"A", t:"Man svarbu kurti gerÄ… atmosferÄ… komandoje.", invert:false},
    {id:"A8", d:"A", t:"KritikÄ… reiÅ¡kiu grieÅ¾tai, be uÅ¾uolankÅ³.", invert:true},
    {id:"A9", d:"A", t:"Lengvai nusileidÅ¾iu smulkmenose dÄ—l bendro tikslo.", invert:false},
    {id:"A10", d:"A", t:"DaÅ¾nai pirma galvoju apie save, o ne apie kitus.", invert:true},
    {id:"A11", d:"A", t:"Esu mandagus(-i) ir pagarbus(-i) net esant Ä¯tampai.", invert:false},
    {id:"A12", d:"A", t:"Rungtyniauju labiau nei bendradarbiauju.", invert:true},

    /* N: NeurotiÅ¡kumas (12) */
    {id:"N1", d:"N", t:"Lengvai imu nerimauti dÄ—l Ä¯vairiÅ³ dalykÅ³.", invert:false},
    {id:"N2", d:"N", t:"IÅ¡laikau ramybÄ™ netikÄ—tose situacijose.", invert:true},
    {id:"N3", d:"N", t:"Stresas mane greitai iÅ¡muÅ¡a iÅ¡ vÄ—Å¾iÅ³.", invert:false},
    {id:"N4", d:"N", t:"Retai pergyvenu dÄ—l klaidÅ³.", invert:true},
    {id:"N5", d:"N", t:"Emocijos svyruoja daÅ¾niau nei norÄ—Äiau.", invert:false},
    {id:"N6", d:"N", t:"KritikÄ… priimu be didelio sukrÄ—timo.", invert:true},
    {id:"N7", d:"N", t:"Kartais sunku atsipalaiduoti.", invert:false},
    {id:"N8", d:"N", t:"Miegas ir apetitas beveik visada stabilÅ«s.", invert:true},
    {id:"N9", d:"N", t:"DaÅ¾nai â€pergalvojuâ€œ praeitus Ä¯vykius.", invert:false},
    {id:"N10", d:"N", t:"Retai jauÄiu Ä¯tampÄ… ar nerimÄ….", invert:true},
    {id:"N11", d:"N", t:"StaigÅ«s pokyÄiai mane Ä¯audrina.", invert:false},
    {id:"N12", d:"N", t:"IÅ¡lieku stabilus(-i), kai kiti jaudinasi.", invert:true}
  ];

  /* TipÅ³ vektoriai (O,C,E,A,N) normalizuotoje skalÄ—je â€“1..+1 */
  const TYPES = [
    { name:"DirigentÄ—",  v:{O: 0.3, C: 0.7, E: 0.5, A:-0.1, N:-0.4} },
    { name:"Strategas",   v:{O: 0.6, C: 0.8, E: 0.0, A: 0.2, N:-0.3} },
    { name:"TyrinÄ—tojas", v:{O: 0.9, C: 0.1, E: 0.1, A: 0.2, N: 0.0} },
    { name:"Diplomatas",  v:{O: 0.4, C: 0.5, E: 0.2, A: 0.8, N:-0.2} },
    { name:"Iniciatorius",v:{O: 0.5, C: 0.4, E: 0.8, A: 0.1, N: 0.1} },
    { name:"Analitikas",  v:{O: 0.7, C: 0.7, E:-0.2, A: 0.0, N:-0.2} },
    { name:"RÄ—mÄ—jas",     v:{O: 0.2, C: 0.6, E: 0.3, A: 0.9, N:-0.4} },
    { name:"Novatorius",  v:{O: 0.8, C: 0.3, E: 0.5, A:-0.1, N: 0.0} }
  ];

  const RECS = {
    O: [
      "KiekvienÄ… savaitÄ™ iÅ¡bandyk 1 naujÄ… metodÄ…/Ä¯rankÄ¯ ir uÅ¾raÅ¡yk 3 Ä¯Å¾valgas.",
      "Planuok 2 val. â€mokymosi langÄ…â€œ â€“ kursas, straipsniai, praktika.",
      "PerÅ¾iÅ«rÄ—k 1 procesÄ… ir pasiÅ«lyk maÅ¾Ä… eksperimentÄ… (A/B)."
    ],
    C: [
      "Naudok 2â€‘min taisyklÄ™: jei uÅ¾duotis <2 min â€“ atlik dabar.",
      "Dienos TOPâ€‘3: ryte uÅ¾raÅ¡yk 3 svarbiausias uÅ¾duotis ir paÅ¾ymÄ—k terminus.",
      "Savaitinis â€uÅ¾darymoâ€œ ritualas: sutvarkyk sÄ…raÅ¡us, stalÄiÅ³, kalendoriÅ³."
    ],
    E: [
      "KiekvienÄ… dienÄ… pradÄ—k 1 trumpÄ… pokalbÄ¯ (ğŸ‘‹, klausimas, padÄ—ka).",
      "KartÄ… per savaitÄ™ vesk miniâ€‘susitikimÄ… arba pasidalink Ä¯Å¾valga komandoje.",
      "Praktikuok â€atvirÄ… pozÄ…â€œ: akisâ€‘akis, nugarÄ… tiesiai, aiÅ¡kus balsas."
    ],
    A: [
      "Ä®diek â€veidrodÅ¾ioâ€œ principÄ…: pirmiausia perfrazuok, kÄ… iÅ¡girdai.",
      "Konfliktuose ieÅ¡kok 1 bendro intereso ir 1 maÅ¾o kompromiso.",
      "Duok 1 nuoÅ¡irdÅ³ komplimentÄ… ar padÄ—kÄ… kasdien."
    ],
    N: [
      "3â€‘3â€‘3 nerimo pratimas: 3 dalykai matomi, 3 girdimi, 3 jauÄiami.",
      "Ä®sivesk â€buferÄ¯â€œ: 10 min. tarp susitikimÅ³ kvÄ—pavimui ar pasivaikÅ¡Äiojimui.",
      "Vakare suraÅ¡yk 3 tikslus rytdienai â€“ maÅ¾ina galvos â€sukimÄ…â€œ."
    ]
  };

  /* ====== 2) PagalbinÄ—s ====== */
  const by = (sel, root=document) => root.querySelector(sel);
  const el = (tag, attrs={}, ...children) => {
    const n = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (k === "class") n.className = v;
      else if (k === "html") n.innerHTML = v;
      else if (k.startsWith("on")) n.addEventListener(k.substring(2), v);
      else n.setAttribute(k, v);
    }
    for (const c of children){
      if (typeof c === "string") n.appendChild(document.createTextNode(c));
      else if (c) n.appendChild(c);
    }
    return n;
  };

  function normFromAvg(avg15){ return (avg15 - 3) / 2; }        // -> [-1..+1]
  function pctFromAvg(avg15){ return ((avg15 - 1) / 4) * 100; } // -> [0..100]
  function fmt(n, d=2){ return Number(n).toFixed(d); }
  function mean(arr){ return arr.reduce((a,b)=>a+b,0) / (arr.length||1); }

  function cosineSim(a, b){
    const ks = ["O","C","E","A","N"];
    let dot=0, na=0, nb=0;
    for (const k of ks){ dot += a[k]*b[k]; na += a[k]*a[k]; nb += b[k]*b[k]; }
    return (na===0 || nb===0) ? 0 : dot / Math.sqrt(na*nb);
  }

  /* ====== 3) UI generavimas ====== */
  function renderItems(){
    const host = by("#itemsHost");
    host.innerHTML = "";
    const groups = {O:[],C:[],E:[],A:[],N:[]};
    for (const it of ITEMS) groups[it.d].push(it);

    for (const code of ["O","C","E","A","N"]){
      const card = el("div",{class:"card"});
      card.appendChild(el("h3",{},
        el("span",{class:`domain-tag ${code}`}, code), " ", DOMAINS[code].name
      ));
      for (const it of groups[code]){
        const itemNode = el("div",{class:"item", id:`item-${it.id}`},
          el("div",{}, el("span",{class:"pill"}, it.id), " ", it.t, " ",
            it.invert ? el("span",{class:"inline-note"},"(invertuotas)") : null
          ),
          renderLikert(it.id)
        );
        card.appendChild(itemNode);
      }
      host.appendChild(card);
    }
  }

  function renderLikert(id){
    const scale = el("div",{class:"scale", role:"radiogroup","aria-labelledby":id});
    const labels = {
      1:"VisiÅ¡kai nesutinku", 2:"Nesutinku", 3:"Neutrali(-us)", 4:"Sutinku", 5:"VisiÅ¡kai sutinku"
    };
    for (let v=1; v<=5; v++){
      const inputId = `${id}_${v}`;
      const label = el("label",{},
        el("input",{type:"radio", name:id, id:inputId, value:String(v), onChange:updateProgress, required:true}),
        el("span",{}, String(v)),
        el("span",{class:"inline-note"}, labels[v])
      );
      scale.appendChild(label);
    }
    return scale;
  }

  /* ====== 4) SkaiÄiavimas ====== */
  function collectAnswers(){
    const answers = {};
    for (const it of ITEMS){
      const checked = document.querySelector(`input[name="${it.id}"]:checked`);
      answers[it.id] = checked ? Number(checked.value) : null;
    }
    return answers;
  }

  function invertIfNeeded(value, invert){ return invert ? (value==null?null : 6 - value) : value; }

  function calcScores(){
    const ans = collectAnswers();
    const byDomain = {O:[], C:[], E:[], A:[], N:[]};
    let totalAnswered = 0;
    ITEMS.forEach(it=>{
      const v = ans[it.id];
      const use = invertIfNeeded(v, it.invert);
      if (use!=null){ byDomain[it.d].push(use); totalAnswered++; }
    });
    const out = {};
    for (const d of Object.keys(byDomain)){
      const arr = byDomain[d];
      const avg = arr.length ? mean(arr) : null;
      const norm = (avg==null) ? null : normFromAvg(avg);
      const pct = (avg==null) ? null : pctFromAvg(avg);
      out[d] = {avg, norm, pct, count: arr.length};
    }
    return {scores: out, answered: totalAnswered, total: ITEMS.length};
  }

  function renderResults(model){
    const {scores} = model;

    // LentelÄ—
    const tbody = by("#resTable tbody");
    tbody.innerHTML = "";
    const order = ["O","C","E","A","N"];
    for (const d of order){
      const s = scores[d];
      const tr = el("tr",{},
        el("td",{}, el("span",{class:`domain-tag ${d}`}, d), " ", DOMAINS[d].name),
        el("td",{class:"mono"}, s.avg==null ? "â€“" : fmt(s.avg,2)),
        el("td",{class:"mono"}, s.norm==null? "â€“" : (s.norm>=0?"+":"") + fmt(s.norm,2)),
        el("td",{class:"mono"}, s.pct==null ? "â€“" : fmt(s.pct,0) + "%")
      );
      tbody.appendChild(tr);
    }

    // TOPâ€‘3 stiprybÄ—s ir augimo sritys
    const arr = order.map(d => ({d, ...scores[d]})).filter(x=>x.pct!=null);
    arr.sort((a,b)=>b.pct-a.pct);
    const strengths = arr.slice(0,3);
    const growth = arr.slice(-3).reverse();

    const sBox = by("#strengths"); sBox.innerHTML = "";
    strengths.forEach(x=>{
      const n = el("div",{},
        el("span",{class:`domain-tag ${x.d}`}, x.d),
        " ", DOMAINS[x.d].name, " Â· ",
        el("strong",{}, fmt(x.pct,0)+"%")
      );
      sBox.appendChild(n);
    });

    const gBox = by("#growth"); gBox.innerHTML = "";
    growth.forEach(x=>{
      const card = el("div",{class:`item ${x.pct<40?'danger': (x.pct<60?'': 'ok')}`},
        el("div",{}, el("span",{class:`domain-tag ${x.d}`}, x.d), " ", DOMAINS[x.d].name, " Â· ",
          el("strong",{}, fmt(x.pct,0)+"%")
        ),
        el("ul",{}, ...RECS[x.d].map(r => el("li",{}, r)))
      );
      gBox.appendChild(card);
    });

    // TipÅ³ artimumas (kosinusinis panaÅ¡umas)
    const self = {};
    for (const d of order){ self[d] = scores[d].norm ?? 0; }
    const typed = TYPES.map(t => {
      const sim = cosineSim(self, t.v);              // [-1..+1]
      const pct = Math.round(((sim + 1)/2) * 100);   // 0..100
      return {name:t.name, sim, pct};
    }).sort((a,b)=>b.sim - a.sim).slice(0,3);

    const tBox = by("#typesTop"); tBox.innerHTML = "";
    typed.forEach(t=>{
      tBox.appendChild(el("div",{}, el("span",{class:"pill"}, t.name), " Â· artimumas ",
        el("strong",{}, t.pct+"%")
      ));
    });
  }

  /* ====== 5) Veiksmai / UX ====== */
  function onCalculate(){
    const model = calcScores();
    if (model.answered < model.total){
      const remain = model.total - model.answered;
      by("#fillAllNote").textContent = `UÅ¾pildykite visus teiginius. TrÅ«ksta: ${remain}.`;
      by("#fillAllNote").classList.remove("muted");
      window.location.hash = "#teiginiai";
      setTimeout(()=>window.scrollTo({top: by("#teiginiai").offsetTop - 60, behavior:"smooth"}), 50);
      highlightMissing();
      return;
    }
    by("#fillAllNote").textContent = "Rezultatai apskaiÄiuoti.";
    by("#fillAllNote").classList.add("muted");
    renderResults(model);
    saveToStorage();
    window.location.hash = "#results";
    setTimeout(()=>window.scrollTo({top: by("#results").offsetTop - 60, behavior:"smooth"}), 50);
  }

  function onClear(){
    localStorage.removeItem("divirgent_ocean_answers");
    for (const it of ITEMS){
      const checked = document.querySelector(`input[name="${it.id}"]:checked`);
      if (checked) checked.checked = false;
    }
    document.querySelectorAll(".item.danger").forEach(n=>n.classList.remove("danger"));
    document.querySelectorAll(".item.ok").forEach(n=>n.classList.remove("ok"));
    by("#resTable tbody").innerHTML = "";
    by("#strengths").innerHTML = "";
    by("#growth").innerHTML = "";
    by("#typesTop").innerHTML = "";
    by("#fillAllNote").textContent = "UÅ¾pildykite visus teiginius ir paspauskite â€Gauti rezultatÄ…â€œ.";
    by("#fillAllNote").classList.add("muted");
    updateProgress();
    window.location.hash="";
  }

  function updateProgress(){
    const model = calcScores();
    const pct = Math.round((model.answered / model.total) * 100);
    const bar = by("#progressBar");
    if (bar) bar.style.width = pct + "%";
  }

  function highlightMissing(){
    for (const it of ITEMS){
      const answered = !!document.querySelector(`input[name="${it.id}"]:checked`);
      const node = by(`#item-${it.id}`);
      if (node){
        node.style.borderColor = answered ? "var(--line)" : "#7f1d1d";
      }
    }
    updateProgress();
  }

  /* ====== 6) Saugojimas localStorage ====== */
  function saveToStorage(){
    const ans = collectAnswers();
    localStorage.setItem("divirgent_ocean_answers", JSON.stringify(ans));
  }
  function restoreFromStorage(){
    try{
      const raw = localStorage.getItem("divirgent_ocean_answers");
      if (!raw) return;
      const ans = JSON.parse(raw);
      for (const [id, val] of Object.entries(ans || {})){
        if (val==null) continue;
        const input = document.querySelector(`input[name="${id}"][value="${val}"]`);
        if (input) input.checked = true;
      }
    }catch(e){}
  }

  /* ====== 7) Startas ====== */
  function boot(){
    renderItems();
    restoreFromStorage();
    updateProgress();
    document.getElementById("calcBtn").addEventListener("click", onCalculate);
    document.getElementById("clearBtn").addEventListener("click", onClear);
  }
  document.addEventListener("DOMContentLoaded", boot);
  </script>
</body>
</html>
