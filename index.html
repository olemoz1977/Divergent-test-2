<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Divirgent Test V2.1 – OCEAN (LT)</title>

  <!-- Minimalus UI + pritaikymas spausdinimui -->
  <style>
    :root{
      --bg:#0f1720; --fg:#eaf0f6; --muted:#9fb3c8; --panel:#13212b; --line:#213241;
      --accent:#4dc0b5; --accent2:#1b2a36; --grid:#22323f;
    }
    *{box-sizing:border-box}
    body { background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.45; margin:0; }
    header, main, footer { max-width:980px; margin:0 auto; padding:16px; }
    h1,h2,h3{margin:.6em 0}
    p{margin:.4em 0 .8em}
    .actions { display:flex; flex-wrap:wrap; gap:12px; margin:12px 0 20px; }
    .actions.center { justify-content:center; }
    button { background:var(--accent); color:var(--bg); border:0; padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer; }
    button.secondary { background:var(--accent2); color:var(--fg); border:1px solid #274254; }
    .hidden { display:none !important; }
    #globalError { background:#3b1f29; color:#ffdce0; border:1px solid #6b2737; padding:10px 12px; border-radius:8px; margin:10px 0; }

    .item { padding:14px 12px; border:1px solid var(--line); border-radius:10px; margin:10px 0; background:var(--panel); }
    .item h4 { margin:0 0 10px; font-size:16px; }
    .domain-tag { color:var(--muted); font-weight:500; font-size:12px; margin-left:6px; }
    .scale { display:grid; grid-template-columns: repeat(5, minmax(160px,1fr)); gap:8px; }
    label { display:flex; align-items:center; gap:8px; background:#0f1a23; padding:8px 10px; border-radius:8px; border:1px solid #203141; color:var(--fg); }

    table { width:100%; border-collapse: collapse; margin-top:10px; }
    th, td { border:1px solid var(--line); padding:8px; text-align:left; }
    th { background:#152431; }
    ol { padding-left:22px; }

    footer { color:var(--muted); font-size:13px; text-align:center; padding:20px 16px 28px; }

    /* Spaudiniui – rodome tik santrauką/resultatus (pagal nutylėjimą) */
    @media print {
      body { background:#fff; color:#000; }
      header, footer { color:#000; }
      .no-print { display:none !important; }
      .only-print { display:block !important; }
      .card { page-break-inside: avoid; }
      a { color: #000; text-decoration:none; }
    }
    .only-print { display:none; }
    .print-note { color:var(--muted); font-size:12px; }
    .card { background:#13212b; border:1px solid #213241; border-radius:10px; padding:12px; margin-top:10px; }
  </style>
</head>

<body>
<header>
  <h1>Divirgent Test V2.1 – OCEAN (LT)</h1>
  <p class="no-print">~8–10 min · 60 teiginių · be prisijungimo · skaičiuojama naršyklėje</p>

  <div id="globalError" class="hidden"></div>

  <!-- Greitos komandos viršuje -->
  <div class="actions no-print">
    <button id="btnStart">Pereiti prie teiginių</button>
    <button id="btnReset" class="secondary">Išvalyti</button>
  </div>
</header>

<main>
  <!-- TEIGINIAI -->
  <section id="items" class="card">
    <h2>Teiginiai</h2>
    <p>Likertas: 1 – Visiškai nesutinku · 5 – Visiškai sutinku. Invertuoti teiginiai skaičiuojami priešingai.</p>

    <div id="itemsContainer" class="no-print"></div>

    <!-- „Gauti rezultatą“ – po visais klausimais -->
    <div class="actions center no-print">
      <button id="btnSubmit">Gauti rezultatą</button>
    </div>
  </section>

  <!-- REZULTATAI -->
  <section id="results" class="card">
    <h2>Rezultatai</h2>
    <p id="summary">Užpildykite visus teiginius ir paspauskite „Gauti rezultatą“.</p>

    <table id="tblScores" class="hidden">
      <thead>
        <tr>
          <th>Domenas</th>
          <th>Vidurkis (1–5)</th>
          <th>Normalizuota (–1…+1)</th>
          <th>%</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- TOP‑3 tipų sąrašas (pasirenkama) -->
    <h3 id="typesHdr" class="hidden">Tipų artimumas (TOP‑3)</h3>
    <ol id="topTypes" class="hidden"></ol>

    <div class="actions no-print hidden" id="printActions">
      <button id="btnPrint">Spausdinti PDF</button>
      <span class="print-note">Naudokite naršyklės spausdinimo dialogą „Išsaugoti kaip PDF“.</span>
    </div>

    <!-- Spaudiniui – antraštė -->
    <div class="only-print">
      <h3>PDF santrauka</h3>
      <p id="printMeta"></p>
    </div>
  </section>
</main>

<footer class="no-print">
  © 2025 Divirgent Test · Vieno failo versija (index.html)
</footer>

<!-- 1) Inline JSON – 60 unikalių teiginių (12×E/A/C/N/O) -->
<script type="application/json" id="itemsData">
{
  "name": "Divirgent Test V2.1 (LT)",
  "likert": ["Visiškai nesutinku","Nesutinku","Nei taip, nei ne","Sutinku","Visiškai sutinku"],

  "items_full": [
    /* Ekstraversija (12) */
    {"id":"E1","domain":"Ekstraversija","reverse":false,"text":"Mėgstu bendrauti su nepažįstamais žmonėmis."},
    {"id":"E2","domain":"Ekstraversija","reverse":true,"text":"Mieliau renkuosi laiką vienumoje."},
    {"id":"E3","domain":"Ekstraversija","reverse":false,"text":"Greitai pradedu pokalbį naujoje grupėje."},
    {"id":"E4","domain":"Ekstraversija","reverse":true,"text":"Dideli susibūrimai mane vargina."},
    {"id":"E5","domain":"Ekstraversija","reverse":false,"text":"Jaučiu energijos pakilimą būdamas tarp žmonių."},
    {"id":"E6","domain":"Ekstraversija","reverse":true,"text":"Vengiu būti dėmesio centre."},
    {"id":"E7","domain":"Ekstraversija","reverse":false,"text":"Greitai perimu iniciatyvą grupėje."},
    {"id":"E8","domain":"Ekstraversija","reverse":true,"text":"Nesijaučiu patogiai, kai reikia kalbėti prieš auditoriją."},
    {"id":"E9","domain":"Ekstraversija","reverse":false,"text":"Lengvai mezgu naujas pažintis."},
    {"id":"E10","domain":"Ekstraversija","reverse":true,"text":"Retai imuosi kalbėti pirmas/pirma."},
    {"id":"E11","domain":"Ekstraversija","reverse":false,"text":"Entuziastingai dalyvauju renginiuose."},
    {"id":"E12","domain":"Ekstraversija","reverse":true,"text":"Po socialinių veiklų ilgai atgaunu jėgas."},

    /* Malonumas (12) */
    {"id":"A1","domain":"Malonumas","reverse":false,"text":"Empatiškai reaguoju į kitų jausmus."},
    {"id":"A2","domain":"Malonumas","reverse":true,"text":"Dažnai ginčijuosi dėl smulkmenų."},
    {"id":"A3","domain":"Malonumas","reverse":false,"text":"Lengvai atleidžiu klaidas."},
    {"id":"A4","domain":"Malonumas","reverse":true,"text":"Esu šaltas ir abejingas kitų poreikiams."},
    {"id":"A5","domain":"Malonumas","reverse":false,"text":"Gerbiu skirtingus požiūrius."},
    {"id":"A6","domain":"Malonumas","reverse":true,"text":"Įtariai vertinu kitų ketinimus."},
    {"id":"A7","domain":"Malonumas","reverse":false,"text":"Pastebiu, kai žmogui reikia palaikymo."},
    {"id":"A8","domain":"Malonumas","reverse":true,"text":"Dažnai kalbu kandžiai ar sarkastiškai."},
    {"id":"A9","domain":"Malonumas","reverse":false,"text":"Sąžiningai dalinuosi nuopelnais su komanda."},
    {"id":"A10","domain":"Malonumas","reverse":true,"text":"Greitai teisiu žmones griežčiau nei reikėtų."},
    {"id":"A11","domain":"Malonumas","reverse":false,"text":"Mėgstu ieškoti abiem pusėms tinkamo kompromiso."},
    {"id":"A12","domain":"Malonumas","reverse":true,"text":"Man sunku parodyti šilumą ir rūpestį."},

    /* Sąžiningumas/Atidumas (12) */
    {"id":"C1","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Laikausi tvarkaraščių ir terminų."},
    {"id":"C2","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai atidėlioju pradėti užduotis."},
    {"id":"C3","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Kruopščiai planuoju darbus."},
    {"id":"C4","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Lengvai numetu pradėtą darbą dėl nuobodulio."},
    {"id":"C5","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Atlieku darbus iki galo."},
    {"id":"C6","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai pritrūksta dėmesio detalėms."},
    {"id":"C7","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Mano darbo vieta paprastai tvarkinga."},
    {"id":"C8","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Pradedu darbus jų neapgalvojęs/usi."},
    {"id":"C9","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Nuosekliai siekiu užsibrėžtų tikslų."},
    {"id":"C10","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Greitai prarandu motyvaciją ilguose projektuose."},
    {"id":"C11","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Jaučiu asmeninę atsakomybę už įsipareigojimus."},
    {"id":"C12","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Esu išsiblaškęs ir neorganizuotas."},

    /* Neurotiškumas (12) */
    {"id":"N1","domain":"Neurotiškumas","reverse":false,"text":"Lengvai nerimauju dėl ateities."},
    {"id":"N2","domain":"Neurotiškumas","reverse":true,"text":"Išlaikau ramybę spaudžiant terminams."},
    {"id":"N3","domain":"Neurotiškumas","reverse":false,"text":"Mano nuotaika dažnai svyruoja."},
    {"id":"N4","domain":"Neurotiškumas","reverse":true,"text":"Gerai valdau stresą sudėtingose situacijose."},
    {"id":"N5","domain":"Neurotiškumas","reverse":false,"text":"Greitai susierzinu dėl smulkmenų."},
    {"id":"N6","domain":"Neurotiškumas","reverse":true,"text":"Esu emociškai stabilus ir atsparus."},
    {"id":"N7","domain":"Neurotiškumas","reverse":false,"text":"Kartais jaučiu nerimą be aiškios priežasties."},
    {"id":"N8","domain":"Neurotiškumas","reverse":true,"text":"Net kritikuojamas/-a išlaikau pusiausvyrą."},
    {"id":"N9","domain":"Neurotiškumas","reverse":false,"text":"Lengvai pasiduodu liūdnoms mintims."},
    {"id":"N10","domain":"Neurotiškumas","reverse":true,"text":"Greitai atgaunu vidinę pusiausvyrą po nesėkmės."},
    {"id":"N11","domain":"Neurotiškumas","reverse":false,"text":"Įtampa mane užklumpa net menkniekiuose."},
    {"id":"N12","domain":"Neurotiškumas","reverse":true,"text":"Netikėtose situacijose išlieku ramus/-i."},

    /* Atvirumas patirčiai (12) */
    {"id":"O1","domain":"Atvirumas patirčiai","reverse":false,"text":"Mėgstu tyrinėti naujas idėjas."},
    {"id":"O2","domain":"Atvirumas patirčiai","reverse":true,"text":"Rinkiuosi tik įprastas, patikrintas veiklas."},
    {"id":"O3","domain":"Atvirumas patirčiai","reverse":false,"text":"Domiuosi menu, muzika ar literatūra."},
    {"id":"O4","domain":"Atvirumas patirčiai","reverse":true,"text":"Vengiu abstrakčių ar teorinių temų."},
    {"id":"O5","domain":"Atvirumas patirčiai","reverse":false,"text":"Sugalvoju naujų būdų pagerinti esamus dalykus."},
    {"id":"O6","domain":"Atvirumas patirčiai","reverse":true,"text":"Mieliau lieku prie tradicinių sprendimų."},
    {"id":"O7","domain":"Atvirumas patirčiai","reverse":false,"text":"Smalsiai gilin(u)osi į sudėtingas temas."},
    {"id":"O8","domain":"Atvirumas patirčiai","reverse":true,"text":"Vengiu naujų metodų ar technologijų."},
    {"id":"O9","domain":"Atvirumas patirčiai","reverse":false,"text":"Idėjas dažnai vizualizuoju vaizdais ar metaforomis."},
    {"id":"O10","domain":"Atvirumas patirčiai","reverse":true,"text":"Retai užduodu klausimą „o jeigu…?“."},
    {"id":"O11","domain":"Atvirumas patirčiai","reverse":false,"text":"Mėgstu kurti – nuo sprendimų iki dizaino."},
    {"id":"O12","domain":"Atvirumas patirčiai","reverse":true,"text":"Nelaikau savęs kūrybišku žmogumi."}
  ],

  /* Tipų centroidai (nebūtina – bet palikta TOP‑3 skaičiavimui) */
  "type_centroids": {
    "Dirigentė":   {"E": 0.8,  "A": 0.2,  "C": 0.8,  "ES": 0.6, "O": 0.2},
    "Analitikas":  {"E": -0.6, "A": 0.0,  "C": 0.4,  "ES": 0.6, "O": 0.8},
    "Diplomatė":   {"E": 0.2,  "A": 0.8,  "C": 0.2,  "ES": 0.6, "O": 0.2},
    "Inovatorė":   {"E": 0.6,  "A": -0.2, "C": -0.1, "ES": 0.3, "O": 0.9},
    "Stabilizuotoja":{"E": -0.4,"A": 0.6,  "C": 0.8,  "ES": 0.8, "O": -0.4},
    "Mentorius":   {"E": 0.2,  "A": 0.8,  "C": 0.7,  "ES": 0.7, "O": 0.3},
    "Variklis":    {"E": 0.9,  "A": -0.1, "C": 0.6,  "ES": 0.3, "O": 0.7},
    "Architektė":  {"E": -0.5, "A": -0.3, "C": 0.7,  "ES": 0.7, "O": 0.9}
  }
}
</script>

<!-- 2) Visa logika inline – jokio fetch, jokių išorinių bibliotekų -->
<script>
(() => {
  'use strict';

  // ---- DOM
  const el = {
    btnStart: document.getElementById('btnStart'),
    btnSubmit: document.getElementById('btnSubmit'),
    btnReset: document.getElementById('btnReset'),

    itemsWrap: document.getElementById('itemsContainer'),

    tbl: document.getElementById('tblScores'),
    tblBody: document.querySelector('#tblScores tbody'),

    topHdr: document.getElementById('typesHdr'),
    topList: document.getElementById('topTypes'),

    globalErr: document.getElementById('globalError'),
    summary: document.getElementById('summary'),

    results: document.getElementById('results'),
    printMeta: document.getElementById('printMeta'),
    printActions: document.getElementById('printActions'),
    itemsSection: document.getElementById('items')
  };

  // ---- Būsena
  let META = null;
  let ITEMS = [];

  // ---- Pagalbinės
  const scrollTo = (node) => node?.scrollIntoView({ behavior:'smooth', block:'start' });
  const normMinus1to1 = (mean15) => ((mean15 - 3) / 2);
  const pct0to100     = (mean15) => Math.round(((mean15 - 1) / 4) * 100);

  const showError = (msg) => { if (!el.globalErr) { console.error(msg); return; } el.globalErr.textContent = msg; el.globalErr.classList.remove('hidden'); };
  const clearError = () => { if (!el.globalErr) return; el.globalErr.textContent=''; el.globalErr.classList.add('hidden'); };

  const isReversed = (item, meta) => item?.reverse === true;

  const byDomain = (arr) => {
    const map = new Map();
    for (const r of arr) { if (!map.has(r.domain)) map.set(r.domain, []); map.get(r.domain).push(r.value); }
    const out = {};
    for (const [k, vals] of map.entries()) out[k] = { mean: vals.reduce((a,b)=>a+b,0)/vals.length, n: vals.length };
    return out;
  };

  // N -> ES (emocinis stabilumas)
  const toES = (nNorm) => -nNorm;

  const vectorFromScores = (scores) => {
    const e  = normMinus1to1(scores['Ekstraversija'].mean);
    const a  = normMinus1to1(scores['Malonumas'].mean);
    const c  = normMinus1to1(scores['Sąžiningumas/Atidumas'].mean);
    const n  = normMinus1to1(scores['Neurotiškumas'].mean);
    const es = toES(n);
    const o  = normMinus1to1(scores['Atvirumas patirčiai'].mean);
    return { E:e, A:a, C:c, ES:es, O:o };
  };

  const euclidDist = (p, q) => {
    const keys = ['E','A','C','ES','O'];
    return Math.sqrt(keys.reduce((s,k)=> s + Math.pow((p[k] ?? 0) - (q[k] ?? 0), 2), 0));
  };

  const top3Types = (vec, centroids) => {
    if (!centroids) return [];
    const arr = Object.entries(centroids).map(([name, c]) => {
      const d = euclidDist(vec, c);
      const sim = 1 / (1 + d);
      return { name, dist:d, sim };
    });
    arr.sort((a,b)=> a.dist - b.dist);
    return arr.slice(0,3);
  };

  // ---- Forma
  const renderForm = () => {
    const likert = META?.likert ?? ["Visiškai nesutinku","Nesutinku","Nei taip, nei ne","Sutinku","Visiškai sutinku"];
    const frag = document.createDocumentFragment();
    ITEMS.forEach((it, idx) => {
      const row = document.createElement('div'); row.className = 'item';
      const inv = isReversed(it, META);
      const tag = document.createElement('h4');
      tag.innerHTML = `${idx+1}. ${it.text} <span class="domain-tag">(${it.domain}${inv ? ', invertuotas' : ''})</span>`;
      row.appendChild(tag);

      const scale = document.createElement('div'); scale.className = 'scale';
      for (let v=1; v<=5; v++){
        const id = `${it.id}_${v}`;
        const label = document.createElement('label');
        const input = document.createElement('input');
        input.type = 'radio'; input.name = it.id; input.id = id; input.value = String(v); input.required = true;
        const txt = document.createElement('span'); txt.textContent = `${v} – ${likert[v-1]}`;
        label.htmlFor = id; label.appendChild(input); label.appendChild(txt);
        scale.appendChild(label);
      }
      row.appendChild(scale);
      frag.appendChild(row);
    });
    el.itemsWrap.innerHTML = '';
    el.itemsWrap.appendChild(frag);
  };

  const readResponses = () => {
    const out = [];
    for (const it of ITEMS){
      const sel = document.querySelector(`input[name="${it.id}"]:checked`);
      if (!sel) return { ok:false, missing: it.id };
      const raw = Number(sel.value);
      const val = isReversed(it, META) ? (6 - raw) : raw;
      out.push({ id:it.id, domain:it.domain, raw, value:val });
    }
    return { ok:true, rows: out };
  };

  const renderScores = (scores, vec) => {
    el.tblBody.innerHTML = '';
    const order = ['Ekstraversija','Malonumas','Sąžiningumas/Atidumas','Neurotiškumas','Atvirumas patirčiai'];
    for (const key of order){
      const s = scores[key];
      const tr = document.createElement('tr');
      const norm = normMinus1to1(s.mean);
      tr.innerHTML = `
        <td>${key}</td>
        <td>${s.mean.toFixed(2)}</td>
        <td>${norm >= 0 ? '+' : ''}${norm.toFixed(2)}</td>
        <td>${pct0to100(s.mean)}%</td>
      `;
      el.tblBody.appendChild(tr);
    }
    el.tbl.classList.remove('hidden');

    // TOP-3 (nebūtina – bet paliekam, jei yra centroidai)
    const top = top3Types(vec, META?.type_centroids);
    if (top.length){
      el.topList.innerHTML = '';
      top.forEach(t => {
        const li = document.createElement('li');
        li.textContent = `${t.name} (panašumas ${(t.sim * 100).toFixed(0)}%)`;
        el.topList.appendChild(li);
      });
      el.topHdr.classList.remove('hidden');
      el.topList.classList.remove('hidden');
    }

    el.summary.textContent = 'Rezultatai sugeneruoti. Žemiau – domenų vidurkiai ir (jei taikoma) tipų artimumas.';
    el.printActions.classList.remove('hidden');

    // Paruošiam PDF santraukos metainformaciją
    const ts = new Date();
    el.printMeta.textContent = `Sugeneruota: ${ts.toLocaleString()} · Teiginių sk.: ${ITEMS.length}`;
  };

  const resetForm = () => {
    document.querySelectorAll('#itemsContainer input[type="radio"]').forEach(i => i.checked = false);
    el.tbl.classList.add('hidden');
    el.topHdr.classList.add('hidden');
    el.topList.classList.add('hidden');
    el.topList.innerHTML = '';
    el.printActions.classList.add('hidden');
    el.summary.textContent = 'Užpildykite visus teiginius ir paspauskite „Gauti rezultatą“.';
    clearError();
    scrollTo(document.body);
  };

  const init = () => {
    try {
      const raw = document.getElementById('itemsData')?.textContent?.trim();
      if (!raw) throw new Error('Nerasta inline JSON duomenų.');

      META = JSON.parse(raw);
      ITEMS = Array.isArray(META.items_full) ? META.items_full.slice() : [];
      if (ITEMS.length !== 60) {
        console.warn('[Divirgent] Įspėjimas: teiginių skaičius ≠ 60, dabar:', ITEMS.length);
      }
      renderForm();
    } catch (e) {
      console.error(e);
      showError(`Klaida kraunant klausimus: ${e.message}. Patikrinkite inline JSON formatą.`);
    }
  };

  // Įvykiai
  el.btnStart?.addEventListener('click', () => scrollTo(el.itemsSection));
  el.btnReset?.addEventListener('click', resetForm);
  el.btnSubmit?.addEventListener('click', () => {
    clearError();
    const resp = readResponses();
    if (!resp.ok){ showError(`Neatsakytas teiginys: ${resp.missing}. Užpildykite visus teiginius.`); return; }
    const scores = byDomain(resp.rows);
    const vec = vectorFromScores(scores);
    renderScores(scores, vec);
    scrollTo(el.results);
  });

  // Spausdinimas į PDF
  document.getElementById('btnPrint')?.addEventListener('click', () => {
    // Pagal nutylėjimą spausdiname santrauką/resultatus;
    // jei norėtum įtraukti ir klausimus, pašalink .no-print iš #itemsContainer spausdinimo metu.
    window.print();
  });

  // Startas
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>
</body>
</html>
