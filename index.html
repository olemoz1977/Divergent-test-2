<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Divirgent Test V2.1 – OCEAN + Tipai (LT)</title>

  <!-- Minimalus, tamsus stilius -->
  <style>
    :root{
      --bg:#0f1720; --fg:#eaf0f6; --muted:#9fb3c8; --panel:#13212b; --line:#213241;
      --accent:#4dc0b5; --accent2:#1b2a36; --grid:#22323f;
    }
    *{box-sizing:border-box}
    body { background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.45; margin:0; }
    header, main, footer { max-width:980px; margin:0 auto; padding:16px; }
    h1,h2,h3{margin:.6em 0}
    .actions { display:flex; flex-wrap:wrap; gap:12px; margin:12px 0 20px; }
    button { background:var(--accent); color:var(--bg); border:0; padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer; }
    button.secondary { background:var(--accent2); color:var(--fg); border:1px solid #274254; }
    .hidden { display:none; }
    #globalError { background:#3b1f29; color:#ffdce0; border:1px solid #6b2737; padding:10px 12px; border-radius:8px; margin:10px 0; }

    .item { padding:14px 12px; border:1px solid var(--line); border-radius:10px; margin:10px 0; background:var(--panel); }
    .item h4 { margin:0 0 10px; font-size:16px; }
    .domain-tag { color:var(--muted); font-weight:500; font-size:12px; margin-left:6px; }
    .scale { display:grid; grid-template-columns: repeat(5, minmax(160px,1fr)); gap:8px; }
    label { display:flex; align-items:center; gap:8px; background:#0f1a23; padding:8px 10px; border-radius:8px; border:1px solid #203141; color:var(--fg); }

    table { width:100%; border-collapse: collapse; margin-top:10px; }
    th, td { border:1px solid var(--line); padding:8px; text-align:left; }
    th { background:#152431; }
    ol { padding-left:22px; }
    canvas { background:#0f1a23; border:1px solid var(--line); border-radius:10px; margin-top:12px; }
    footer { color:var(--muted); font-size:13px; text-align:center; padding-bottom:24px; }
  </style>
</head>
<body>
<header>
  <h1>Divirgent Test V2.1 – OCEAN + Tipai (LT)</h1>
  <p>~8–10 min · 60 teiginių · be prisijungimo · skaičiuojama naršyklėje</p>
  <div class="actions">
    <button id="btnStart">Pradėti testą</button>
    <button id="btnSubmit">Gauti rezultatą</button>
    <button id="btnReset" class="secondary">Išvalyti</button>
  </div>
  <div id="globalError" class="hidden"></div>
</header>

<main>
  <section id="items">
    <h2>Teiginiai</h2>
    <p>Likertas: 1 – Visiškai nesutinku · 5 – Visiškai sutinku. Invertuoti teiginiai skaičiuojami priešingai.</p>
    <div id="itemsContainer"></div>
  </section>

  <section id="results">
    <h2>Rezultatai</h2>
    <p id="summary">Užpildykite visus teiginius ir paspauskite „Gauti rezultatą“.</p>

    <table id="tblScores" class="hidden">
      <thead>
        <tr>
          <th>Domenas</th>
          <th>Vidurkis (1–5)</th>
          <th>Normalizuota (–1…+1)</th>
          <th>%</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3 id="typesHdr" class="hidden">Tipų artimumas (TOP‑3)</h3>
    <ol id="topTypes" class="hidden"></ol>

    <h3>Radar</h3>
    <canvas id="radar" width="560" height="420"></canvas>
  </section>
</main>

<footer>
  © 2025 Divirgent Test · Atviro kodo demonstracija · Suderinama su GitHub Pages
</footer>

<!-- 1) Įdėtas JSON kaip inline duomenys – jokių fetch -->
<script type="application/json" id="itemsData">
{
  "name": "Divirgent Test V2.0 (LT)",
  "likert": ["Visiškai nesutinku", "Nesutinku", "Nei taip, nei ne", "Sutinku", "Visiškai sutinku"],
  "items_core": [
    {"id":"E1","domain":"Ekstraversija","reverse":false,"text":"Mėgstu bendrauti su nepažįstamais žmonėmis."},
    {"id":"E2","domain":"Ekstraversija","reverse":true,"text":"Linkęs laiką leisti vienumoje."},
    {"id":"E3","domain":"Ekstraversija","reverse":false,"text":"Greitai pradedu pokalbį naujoje grupėje."},
    {"id":"E4","domain":"Ekstraversija","reverse":true,"text":"Dažniau renkuosi tylą ir stebėjimą nei kalbėjimą."},
    {"id":"E5","domain":"Ekstraversija","reverse":false,"text":"Jaučiu energijos pakilimą būdamas tarp žmonių."},
    {"id":"E6","domain":"Ekstraversija","reverse":true,"text":"Vengiu dėmesio centro."},
    {"id":"A1","domain":"Malonumas","reverse":false,"text":"Empatiškai reaguoju į kitų jausmus."},
    {"id":"A2","domain":"Malonumas","reverse":true,"text":"Linkęs ginčytis ir kabinėtis dėl smulkmenų."},
    {"id":"A3","domain":"Malonumas","reverse":false,"text":"Lengvai atleidžiu klaidas."},
    {"id":"A4","domain":"Malonumas","reverse":true,"text":"Esu šaltas ir abejingas kitų poreikiams."},
    {"id":"A5","domain":"Malonumas","reverse":false,"text":"Gerbiu žmonių skirtumus ir požiūrius."},
    {"id":"A6","domain":"Malonumas","reverse":true,"text":"Dažnai įtariu blogiausius kitų ketinimus."},
    {"id":"C1","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Laikausi tvarkos ir terminų."},
    {"id":"C2","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai atidėlioju pradėti užduotis."},
    {"id":"C3","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Sistemingai planuoju užduotis."},
    {"id":"C4","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Mano darbo aplinka dažniausiai chaotiška."},
    {"id":"C5","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Atlieku darbus iki galo."},
    {"id":"C6","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Esu išsiblaškęs ir neatsakingas."}
  ],
  "items_full": [
    {"id":"E1","domain":"Ekstraversija","reverse":false,"text":"Mėgstu bendrauti su nepažįstamais žmonėmis."},
    {"id":"E2","domain":"Ekstraversija","reverse":true,"text":"Linkęs laiką leisti vienumoje."},
    {"id":"E3","domain":"Ekstraversija","reverse":false,"text":"Greitai pradedu pokalbį naujoje grupėje."},
    {"id":"E4","domain":"Ekstraversija","reverse":true,"text":"Dažniau renkuosi tylą ir stebėjimą nei kalbėjimą."},
    {"id":"E5","domain":"Ekstraversija","reverse":false,"text":"Jaučiu energijos pakilimą būdamas tarp žmonių."},
    {"id":"E6","domain":"Ekstraversija","reverse":true,"text":"Vengiu dėmesio centro."},
    {"id":"E7","domain":"Ekstraversija","reverse":false,"text":"Greitai perimu iniciatyvą grupėje."},
    {"id":"E8","domain":"Ekstraversija","reverse":true,"text":"Dažniausiai leidžiu kitiems vesti pokalbį."},
    {"id":"E9","domain":"Ekstraversija","reverse":false,"text":"Rytais jaučiuosi žvalus ir veiksnus."},
    {"id":"E10","domain":"Ekstraversija","reverse":true,"text":"Po socialinių renginių jaučiuosi išsekęs ilgą laiką."},
    {"id":"E11","domain":"Ekstraversija","reverse":false,"text":"Lengvai mezgu naujas pažintis."},
    {"id":"E12","domain":"Ekstraversija","reverse":true,"text":"Retai imuosi kalbėti pirmas/pirma."},

    {"id":"A1","domain":"Malonumas","reverse":false,"text":"Empatiškai reaguoju į kitų jausmus."},
    {"id":"A2","domain":"Malonumas","reverse":true,"text":"Linkęs ginčytis ir kabinėtis dėl smulkmenų."},
    {"id":"A3","domain":"Malonumas","reverse":false,"text":"Lengvai atleidžiu klaidas."},
    {"id":"A4","domain":"Malonumas","reverse":true,"text":"Esu šaltas ir abejingas kitų poreikiams."},
    {"id":"A5","domain":"Malonumas","reverse":false,"text":"Gerbiu žmonių skirtumus ir požiūrius."},
    {"id":"A6","domain":"Malonumas","reverse":true,"text":"Dažnai įtariu blogiausius kitų ketinimus."},
    {"id":"A7","domain":"Malonumas","reverse":false,"text":"Pastebiu, kai žmogui reikia palaikymo."},
    {"id":"A8","domain":"Malonumas","reverse":true,"text":"Dažnai kalbu kandžiai ar sarkastiškai."},
    {"id":"A9","domain":"Malonumas","reverse":false,"text":"Stengiuosi sąžiningai dalintis nuopelnais."},
    {"id":"A10","domain":"Malonumas","reverse":true,"text":"Neretai abejoju kitų žmonių gerais ketinimais."},
    {"id":"A11","domain":"Malonumas","reverse":false,"text":"Mėgstu rasti kompromisą konfliktuose."},
    {"id":"A12","domain":"Malonumas","reverse":true,"text":"Linkęs teisti žmones griežčiau nei reikėtų."},

    {"id":"C1","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Man patinka sudaryti kontrolinius sąrašus."},
    {"id":"C2","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai pradedu užduotis jų neapgalvojęs/usi."},
    {"id":"C3","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Esu ištvermingas ir nuoseklus siekdamas tikslo."},
    {"id":"C4","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Lengvai numetu pradėtą darbą dėl nuobodulio."},
    {"id":"C5","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Jaučiu atsakomybę laikytis įsipareigojimų."},
    {"id":"C6","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai pritrūksta dėmesio detalėms."},
    {"id":"C7","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Man patinka sudaryti kontrolinius sąrašus."},
    {"id":"C8","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai pradedu užduotis jų neapgalvojęs/usi."},
    {"id":"C9","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Esu ištvermingas ir nuoseklus siekdamas tikslo."},
    {"id":"C10","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Lengvai numetu pradėtą darbą dėl nuobodulio."},
    {"id":"C11","domain":"Sąžiningumas/Atidumas","reverse":false,"text":"Jaučiu atsakomybę laikytis įsipareigojimų."},
    {"id":"C12","domain":"Sąžiningumas/Atidumas","reverse":true,"text":"Dažnai pritrūksta dėmesio detalėms."},

    {"id":"N1","domain":"Neurotiškumas","reverse":false,"text":"Lengvai nerimauju dėl ateities."},
    {"id":"N2","domain":"Neurotiškumas","reverse":true,"text":"Išlaikau ramybę net spaudžiant terminams."},
    {"id":"N3","domain":"Neurotiškumas","reverse":false,"text":"Dažnai svyruoja nuotaika."},
    {"id":"N4","domain":"Neurotiškumas","reverse":true,"text":"Gerai valdau stresą sudėtingose situacijose."},
    {"id":"N5","domain":"Neurotiškumas","reverse":false,"text":"Greitai įsižeidžiu ar susierzinu."},
    {"id":"N6","domain":"Neurotiškumas","reverse":true,"text":"Esu emociškai stabilus ir atsparus."},
    {"id":"N7","domain":"Neurotiškumas","reverse":false,"text":"Kartais be aiškios priežasties jaučiu nerimą."},
    {"id":"N8","domain":"Neurotiškumas","reverse":true,"text":"Net ir kritikuojamas/-a išlaikau vidinę pusiausvyrą."},
    {"id":"N9","domain":"Neurotiškumas","reverse":false,"text":"Lengvai pasiduodu liūdnoms mintims."},
    {"id":"N10","domain":"Neurotiškumas","reverse":true,"text":"Greitai atgaunu emocinę pusiausvyrą po nesėkmės."},
    {"id":"N11","domain":"Neurotiškumas","reverse":false,"text":"Smulkmenos mane stipriai suerzina."},
    {"id":"N12","domain":"Neurotiškumas","reverse":true,"text":"Nestresuoju netikėtose situacijose."},

    {"id":"O1","domain":"Atvirumas patirčiai","reverse":false,"text":"Man patinka tyrinėti naujas idėjas."},
    {"id":"O2","domain":"Atvirumas patirčiai","reverse":true,"text":"Rinkiuosi įprastas, patikrintas veiklas."},
    {"id":"O3","domain":"Atvirumas patirčiai","reverse":false,"text":"Mėgstu meną, muziką ar literatūrą."},
    {"id":"O4","domain":"Atvirumas patirčiai","reverse":true,"text":"Retai susidomiu abstrakčiomis temomis."},
    {"id":"O5","domain":"Atvirumas patirčiai","reverse":false,"text":"Dažnai sugalvoju naujų būdų pagerinti esamus dalykus."},
    {"id":"O6","domain":"Atvirumas patirčiai","reverse":true,"text":"Mieliau lieku prie tradicinių sprendimų."},
    {"id":"O7","domain":"Atvirumas patirčiai","reverse":false,"text":"Smalsiai gilinuosi į sudėtingas temas."},
    {"id":"O8","domain":"Atvirumas patirčiai","reverse":true,"text":"Vengiu naujų metodų ar technologijų."},
    {"id":"O9","domain":"Atvirumas patirčiai","reverse":false,"text":"Idėjas dažnai vizualizuoju vaizdais ar metaforomis."},
    {"id":"O10","domain":"Atvirumas patirčiai","reverse":true,"text":"Retai užduodu klausimą „o jeigu…?“."},
    {"id":"O11","domain":"Atvirumas patirčiai","reverse":false,"text":"Mėgstu kurti – nuo sprendimų iki dizaino."},
    {"id":"O12","domain":"Atvirumas patirčiai","reverse":true,"text":"Nelaikau savęs kūrybišku žmogumi."}
  ],
  "reverse_ids": ["E2","E4","E6","A2","A4","A6","C2","C4","C6","N2","N4","N6","O2","O4","O6","E8","E10","E12","A8","A10","A12","C8","C10","C12","N8","N10","N12","O8","O10","O12"],
  "type_centroids": {
    "Dirigentė":   {"E": 0.8,  "A": 0.2,  "C": 0.8,  "ES": 0.6, "O": 0.2},
    "Analitikas":  {"E": -0.6, "A": 0.0,  "C": 0.4,  "ES": 0.6, "O": 0.8},
    "Diplomatė":   {"E": 0.2,  "A": 0.8,  "C": 0.2,  "ES": 0.6, "O": 0.2},
    "Inovatorė":   {"E": 0.6,  "A": -0.2, "C": -0.1, "ES": 0.3, "O": 0.9},
    "Stabilizuotoja":{"E": -0.4,"A": 0.6,  "C": 0.8,  "ES": 0.8, "O": -0.4},
    "Mentorius":   {"E": 0.2,  "A": 0.8,  "C": 0.7,  "ES": 0.7, "O": 0.3},
    "Variklis":    {"E": 0.9,  "A": -0.1, "C": 0.6,  "ES": 0.3, "O": 0.7},
    "Architektė":  {"E": -0.5, "A": -0.3, "C": 0.7,  "ES": 0.7, "O": 0.9}
  },
  "notes": "Klausimai sukurti remiantis Big Five; struktūrinės gairės orientuotos į BFI-2-S (Soto & John, 2017) ir IPIP viešo domeno praktiką.",
  "disclaimer": "Tai nėra klinikinis instrumentas. Naudoti mokymui, savirefleksijai ir demonstracijai; be normų rezultatų interpretacija yra indikatyvi."
}
</script>

<!-- 2) Chart.js UMD (globalus window.Chart). Jei nori offline – galiu įdėti inline versiją. -->
https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js</script>

<!-- 3) Visa logika inline – jokio fetch, jokio app.js failo -->
<script>
(() => {
  'use strict';

  // ---- DOM nuorodos
  const el = {
    btnStart: document.getElementById('btnStart'),
    btnSubmit: document.getElementById('btnSubmit'),
    btnReset: document.getElementById('btnReset'),

    itemsWrap: document.getElementById('itemsContainer'),

    tbl: document.getElementById('tblScores'),
    tblBody: document.querySelector('#tblScores tbody'),

    topHdr: document.getElementById('typesHdr'),
    topList: document.getElementById('topTypes'),

    globalErr: document.getElementById('globalError'),
    summary: document.getElementById('summary'),

    radar: document.getElementById('radar')
  };

  // ---- Būsena
  let META = null;
  let ITEMS = [];
  let RADAR = null;

  // ---- Pagalbinės
  const scrollTo = (node) => node?.scrollIntoView({ behavior:'smooth', block:'start' });
  const normMinus1to1 = (mean15) => ((mean15 - 3) / 2);
  const pct0to100     = (mean15) => Math.round(((mean15 - 1) / 4) * 100);
  const showError = (msg) => { if (!el.globalErr) { console.error(msg); return; } el.globalErr.textContent = msg; el.globalErr.classList.remove('hidden'); };
  const clearError = () => { if (!el.globalErr) return; el.globalErr.textContent=''; el.globalErr.classList.add('hidden'); };
  const isReversed = (item, meta) => item?.reverse === true || (meta?.reverse_ids?.includes(item.id) ?? false);

  const byDomain = (arr) => {
    const map = new Map();
    for (const r of arr) { if (!map.has(r.domain)) map.set(r.domain, []); map.get(r.domain).push(r.value); }
    const out = {};
    for (const [k, vals] of map.entries()) out[k] = { mean: vals.reduce((a,b)=>a+b,0)/vals.length, n: vals.length };
    return out;
  };

  const toES = (nNorm) => -nNorm;
  const vectorFromScores = (scores) => {
    const e  = normMinus1to1(scores['Ekstraversija'].mean);
    const a  = normMinus1to1(scores['Malonumas'].mean);
    const c  = normMinus1to1(scores['Sąžiningumas/Atidumas'].mean);
    const n  = normMinus1to1(scores['Neurotiškumas'].mean);
    const es = toES(n);
    const o  = normMinus1to1(scores['Atvirumas patirčiai'].mean);
    return { E:e, A:a, C:c, ES:es, O:o };
  };

  const euclidDist = (p, q) => {
    const keys = ['E','A','C','ES','O'];
    return Math.sqrt(keys.reduce((s,k)=> s + Math.pow((p[k] ?? 0) - (q[k] ?? 0), 2), 0));
  };

  const top3Types = (vec, centroids) => {
    const dict = centroids || {};
    const arr = Object.entries(dict).map(([name, c]) => {
      const d = euclidDist(vec, c);
      const sim = 1 / (1 + d);
      return { name, dist:d, sim };
    });
    arr.sort((a,b)=> a.dist - b.dist);
    return arr.slice(0,3);
  };

  // ---- Render formos
  const renderForm = () => {
    if (!el.itemsWrap) return showError('Nerastas #itemsContainer.');
    const likert = META?.likert ?? ["Visiškai nesutinku","Nesutinku","Nei taip, nei ne","Sutinku","Visiškai sutinku"];
    const frag = document.createDocumentFragment();

    ITEMS.forEach((it, idx) => {
      const row = document.createElement('div'); row.className = 'item';
      const inv = isReversed(it, META);
      const tag = document.createElement('h4');
      tag.innerHTML = `${idx+1}. ${it.text} <span class="domain-tag">(${it.domain}${inv ? ', invertuotas' : ''})</span>`;
      row.appendChild(tag);

      const scale = document.createElement('div'); scale.className = 'scale';
      for (let v=1; v<=5; v++){
        const id = `${it.id}_${v}`;
        const label = document.createElement('label');
        const input = document.createElement('input');
        input.type = 'radio'; input.name = it.id; input.id = id; input.value = String(v); input.required = true;
        const txt = document.createElement('span'); txt.textContent = `${v} – ${likert[v-1]}`;
        label.htmlFor = id; label.appendChild(input); label.appendChild(txt);
        scale.appendChild(label);
      }
      row.appendChild(scale);
      frag.appendChild(row);
    });

    el.itemsWrap.innerHTML = '';
    el.itemsWrap.appendChild(frag);
  };

  // ---- Skaitymas iš formos
  const readResponses = () => {
    const out = [];
    for (const it of ITEMS){
      const sel = document.querySelector(`input[name="${it.id}"]:checked`);
      if (!sel) return { ok:false, missing: it.id };
      const raw = Number(sel.value);
      const val = isReversed(it, META) ? (6 - raw) : raw;
      out.push({ id:it.id, domain:it.domain, raw, value:val });
    }
    return { ok:true, rows: out };
  };

  // ---- Rezultatų vaizdavimas
  const renderScores = (scores, vec) => {
    if (!el.tblBody || !el.tbl) return;
    el.tblBody.innerHTML = '';
    const order = ['Ekstraversija','Malonumas','Sąžiningumas/Atidumas','Neurotiškumas','Atvirumas patirčiai'];

    for (const key of order){
      const s = scores[key];
      const tr = document.createElement('tr');
      const norm = normMinus1to1(s.mean);
      tr.innerHTML = `
        <td>${key}</td>
        <td>${s.mean.toFixed(2)}</td>
        <td>${norm >= 0 ? '+' : ''}${norm.toFixed(2)}</td>
        <td>${pct0to100(s.mean)}%</td>
      `;
      el.tblBody.appendChild(tr);
    }
    el.tbl.classList.remove('hidden');

    const top = top3Types(vec, META?.type_centroids || {});
    el.topList.innerHTML = '';
    top.forEach(t => {
      const li = document.createElement('li');
      li.textContent = `${t.name} (panašumas ${(t.sim*100).toFixed(0)}%)`;
      el.topList.appendChild(li);
    });
    el.topHdr.classList.remove('hidden');
    el.topList.classList.remove('hidden');

    if (el.summary) el.summary.textContent = 'Rezultatai sugeneruoti. Žemiau – domenų vidurkiai ir tipų artimumas.';
  };

  // ---- Radar
  const renderRadar = (scores) => {
    if (!el.radar) return;
    if (typeof Chart === 'undefined'){ console.warn('Chart.js nerasta – radaras nebus nupieštas.'); return; }

    const labels = ['E','A','C','ES','O'];
    const mean = {
      E: scores['Ekstraversija'].mean,
      A: scores['Malonumas'].mean,
      C: scores['Sąžiningumas/Atidumas'].mean,
      ES: 6 - scores['Neurotiškumas'].mean,
      O: scores['Atvirumas patirčiai'].mean
    };
    const dataPct = labels.map(k => pct0to100(mean[k]));

    const cfg = {
      type: 'radar',
      data: {
        labels,
        datasets: [{
          label: 'Domenai (0–100%)',
          data: dataPct,
          fill: true,
          backgroundColor: 'rgba(77,192,181,0.2)',
          borderColor: 'rgba(77,192,181,1)',
          pointBackgroundColor: 'rgba(77,192,181,1)'
        }]
      },
      options: {
        responsive: true,
        scales: {
          r: {
            min:0, max:100,
            ticks:{ stepSize:20, color:'#b7c8d1' },
            grid:{ color:'#22323f' },
            angleLines:{ color:'#22323f' },
            pointLabels:{ color:'#eaf0f6' }
          }
        },
        plugins:{ legend:{ labels:{ color:'#eaf0f6' } } }
      }
    };

    if (RADAR) RADAR.destroy();
    RADAR = new Chart(el.radar, cfg);
  };

  // ---- Reset
  const resetForm = () => {
    document.querySelectorAll('#itemsContainer input[type="radio"]').forEach(i => i.checked = false);
    el.tbl.classList.add('hidden');
    el.topHdr.classList.add('hidden');
    el.topList.classList.add('hidden');
    el.topList.innerHTML = '';
    el.summary.textContent = 'Užpildykite visus teiginius ir paspauskite „Gauti rezultatą“.';
    if (RADAR){ RADAR.destroy(); RADAR = null; }
    clearError();
  };

  // ---- Inicijavimas (be jokių fetch) – skaitome iš <script type="application/json" id="itemsData">
  const init = () => {
    try {
      const raw = document.getElementById('itemsData')?.textContent?.trim();
      if (!raw) throw new Error('Nerasta inline JSON duomenų.');
      META = JSON.parse(raw);

      ITEMS = Array.isArray(META.items_full) && META.items_full.length
        ? META.items_full
        : (Array.isArray(META.items_core) && META.items_core.length ? META.items_core : []);
      if (!ITEMS.length) throw new Error('JSON neturi items_full / items_core.');

      renderForm();
      clearError();
      // Diagnostika:
      // console.log('[Divirgent] init OK. ITEMS=', ITEMS.length, 'DOM children=', el.itemsWrap.childElementCount);
    } catch (e) {
      console.error(e);
      showError(`Klaida kraunant klausimus: ${e.message}. Patikrinkite inline JSON formatą.`);
    }
  };

  // ---- Įvykiai
  el.btnStart?.addEventListener('click', () => scrollTo(document.getElementById('items')));
  el.btnReset?.addEventListener('click', resetForm);
  el.btnSubmit?.addEventListener('click', () => {
    clearError();
    const resp = readResponses();
    if (!resp.ok){ showError(`Neatsakytas teiginys: ${resp.missing}. Užpildykite visus teiginius.`); return; }
    const scores = byDomain(resp.rows);
    const vec = vectorFromScores(scores);
    renderScores(scores, vec);
    renderRadar(scores);
    scrollTo(document.getElementById('results'));
  });

  // ---- Startas
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
</body>
</html>
